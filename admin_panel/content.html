<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content - Gator AI Admin</title>
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5568d3;
            --accent: #10b981;
            --dark-bg: #0f0f1e;
            --dark-surface: #1a1a2e;
            --dark-card: #16213e;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --sidebar-width: 260px;
            --border-color: #2a2a3e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--dark-surface);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .logo-icon {
            font-size: 2rem;
        }
        
        .tenant-selector {
            margin-top: 16px;
            padding: 12px;
            background: var(--dark-card);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tenant-selector:hover {
            border-color: var(--primary);
        }
        
        .tenant-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }
        
        .tenant-plan {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .nav-section {
            padding: 20px 16px 8px;
        }
        
        .nav-section-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 8px;
            padding: 0 12px;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 4px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s;
            font-size: 0.9rem;
        }
        
        .nav-link:hover {
            background: var(--dark-card);
            color: var(--text-primary);
        }
        
        .nav-link.active {
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            font-weight: 600;
        }
        
        .nav-icon {
            font-size: 1.3rem;
            width: 24px;
            text-align: center;
        }
        
        .badge {
            margin-left: auto;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            background: var(--accent);
            color: white;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            display: flex;
            flex-direction: column;
        }
        
        .topbar {
            height: 70px;
            background: var(--dark-surface);
            border-bottom: 1px solid var(--border-color);
            padding: 0 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .topbar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-input {
            width: 300px;
            padding: 10px 16px 10px 40px;
            background: var(--dark-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        .topbar-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .icon-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--dark-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .icon-btn:hover {
            border-color: var(--primary);
        }
        
        .content-area {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: var(--dark-card);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            border-color: var(--primary);
        }
        
        .section {
            background: var(--dark-surface);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        .toolbar {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .toolbar-search {
            flex: 1;
            min-width: 250px;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state h2 {
            color: var(--text-primary);
            margin-bottom: 12px;
        }
        
        .empty-state p {
            margin-bottom: 24px;
        }
        
        .card {
            background: var(--dark-surface);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.2s;
        }
        
        .card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-icon" id="brand-icon">üêä</span>
                <span id="brand-name">AI Platform</span>
            </div>
            
            <div class="tenant-selector" onclick="switchTenant()">
                <div class="tenant-name" id="tenant-name">My Instance</div>
                <div class="tenant-plan"><span id="tenant-plan-text">Self-Hosted</span> ‚Ä¢ GPU Enabled</div>
            </div>
        </div>
        
        <nav class="nav-section">
            <div class="nav-section-title">Main</div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="/admin" class="nav-link ">
                        <span class="nav-icon">üìä</span>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin/personas" class="nav-link ">
                        <span class="nav-icon">üé≠</span>
                        <span>Personas</span>
                        <span class="badge" id="persona-badge">0</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin/content" class="nav-link active">
                        <span class="nav-icon">üé®</span>
                        <span>Content</span>
                    </a>
                </li>
            </ul>
        </nav>
        
        <nav class="nav-section">
            <div class="nav-section-title">Resources</div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="/ai-models-setup" class="nav-link">
                        <span class="nav-icon">ü§ñ</span>
                        <span>AI Models</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin/rss" class="nav-link ">
                        <span class="nav-icon">üì°</span>
                        <span>RSS Feeds</span>
                    </a>
                </li>
            </ul>
        </nav>
        
        <nav class="nav-section">
            <div class="nav-section-title">Insights</div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="/admin/analytics" class="nav-link ">
                        <span class="nav-icon">üìà</span>
                        <span>Analytics</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin/diagnostics" class="nav-link">
                        <span class="nav-icon">ü§ñ</span>
                        <span>AI Diagnostics</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/gallery" class="nav-link">
                        <span class="nav-icon">üåê</span>
                        <span>Public View</span>
                    </a>
                </li>
            </ul>
        </nav>
        
        <nav class="nav-section" style="margin-top: auto;">
            <div class="nav-section-title">System</div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="/admin/system-monitoring" class="nav-link">
                        <span class="nav-icon">üå°Ô∏è</span>
                        <span>System Monitor</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin/settings" class="nav-link ">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span>Settings</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/docs" class="nav-link">
                        <span class="nav-icon">üìö</span>
                        <span>API Docs</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
        <div class="topbar">
            <div class="topbar-left">
                <h1 class="page-title">Content</h1>
            </div>
            
            <div class="topbar-right">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" placeholder="Search...">
                </div>
                <div class="icon-btn">üîî</div>
                <div class="icon-btn">üë§</div>
            </div>
        </div>
        
        <div class="content-area">
            <!-- Content Management -->
            <div class="toolbar">
                <div class="toolbar-search">
                    <input type="text" class="search-input" id="search-content" placeholder="Search content..." style="width: 100%;">
                </div>
                <button class="btn btn-primary" onclick="generateContentForAll()" style="margin-right: 8px;">
                    üöÄ Generate for All Personas
                </button>
                <button class="btn btn-primary" onclick="generateContent()">
                    ‚ûï Generate Content
                </button>
            </div>
            
            <div id="content-container">
                <div class="empty-state">
                    <h2>No Content Yet</h2>
                    <p>Generate your first piece of content to get started.</p>
                    <button class="btn btn-primary" onclick="generateContent()">
                        üé® Generate Content
                    </button>
                </div>
            </div>
        </div>
    </main>
    
    <script>
        // Load branding configuration
        async function loadBranding() {
            try {
                const response = await fetch('/api/v1/branding');
                const branding = await response.json();
                
                document.getElementById('brand-name').textContent = branding.site_name || 'AI Platform';
                document.getElementById('brand-icon').textContent = branding.icon || 'üêä';
                document.getElementById('tenant-name').textContent = branding.instance_name || 'My Instance';
            } catch (e) {
                console.log('Using default branding');
            }
        }
        
        function switchTenant() {
            alert('Tenant switching coming soon! This will allow you to manage multiple tenants.');
        }
        
        // Load branding on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadBranding();
        });

        // Format date helper
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) return `${days}d ago`;
            if (hours > 0) return `${hours}h ago`;
            if (minutes > 0) return `${minutes}m ago`;
            return 'Just now';
        }
        
        // Get status badge
        function getStatusBadge(status) {
            const statusMap = {
                'pending': { bg: 'rgba(245, 158, 11, 0.2)', color: '#f59e0b', icon: '‚è≥', text: 'Pending' },
                'approved': { bg: 'rgba(16, 185, 129, 0.2)', color: '#10b981', icon: '‚úÖ', text: 'Approved' },
                'rejected': { bg: 'rgba(239, 68, 68, 0.2)', color: '#ef4444', icon: '‚ùå', text: 'Rejected' },
                'flagged': { bg: 'rgba(245, 158, 11, 0.2)', color: '#f59e0b', icon: '‚ö†Ô∏è', text: 'Flagged' }
            };
            const s = statusMap[status] || { bg: 'rgba(160, 160, 176, 0.2)', color: '#a0a0b0', icon: '‚ùì', text: status };
            return `<span style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem; font-weight: 600; background: ${s.bg}; color: ${s.color};">${s.icon} ${s.text}</span>`;
        }
        
        // Get agent status badge
        function getAgentStatusBadge(acdContext) {
            if (!acdContext) {
                return `<span style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem; background: rgba(160, 160, 176, 0.1); color: var(--text-secondary);">‚ö™ No Tracking</span>`;
            }
            
            const stateMap = {
                'PENDING': { icon: '‚è≥', text: 'Pending', color: '#f59e0b', bg: 'rgba(245, 158, 11, 0.2)' },
                'READY': { icon: 'üü¢', text: 'Ready', color: '#10b981', bg: 'rgba(16, 185, 129, 0.2)' },
                'PROCESSING': { icon: '‚öôÔ∏è', text: 'Processing', color: '#3b82f6', bg: 'rgba(59, 130, 246, 0.2)' },
                'BLOCKED': { icon: 'üî¥', text: 'Blocked', color: '#f59e0b', bg: 'rgba(245, 158, 11, 0.2)' },
                'COMPLETED': { icon: '‚úÖ', text: 'Completed', color: '#10b981', bg: 'rgba(16, 185, 129, 0.2)' },
                'DONE': { icon: '‚úÖ', text: 'Completed', color: '#10b981', bg: 'rgba(16, 185, 129, 0.2)' },
                'FAILED': { icon: '‚ùå', text: 'Failed', color: '#ef4444', bg: 'rgba(239, 68, 68, 0.2)' }
            };
            
            const state = acdContext.state || 'PENDING';
            const s = stateMap[state] || stateMap['PENDING'];
            
            let tooltip = `Phase: ${acdContext.phase || 'unknown'}\nState: ${state}`;
            if (acdContext.note) tooltip += `\nNote: ${acdContext.note}`;
            if (acdContext.assigned_to) tooltip += `\nAssigned: ${acdContext.assigned_to}`;
            
            return `<span title="${tooltip}" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem; font-weight: 600; background: ${s.bg}; color: ${s.color};">${s.icon} ${s.text}</span>`;
        }
        
        // Get content type icon
        function getContentIcon(type) {
            const iconMap = {
                'image': 'üñºÔ∏è',
                'video': 'üé¨',
                'audio': 'üéµ',
                'voice': 'üó£Ô∏è',
                'text': 'üìù'
            };
            return iconMap[type] || 'üìÑ';
        }
        
        // Load agent status for a specific content item
        async function loadAgentStatus(contentId) {
            try {
                const response = await fetch(`/api/v1/content/${contentId}/status`);
                const status = await response.json();
                
                const cell = document.getElementById(`agent-status-${contentId}`);
                if (!cell) return; // Cell might not exist if table was reloaded
                
                if (status.has_acd_context && status.acd_context) {
                    cell.innerHTML = getAgentStatusBadge(status.acd_context);
                } else {
                    cell.innerHTML = getAgentStatusBadge(null);
                }
            } catch (error) {
                console.error(`Failed to load agent status for ${contentId}:`, error);
                const cell = document.getElementById(`agent-status-${contentId}`);
                if (cell) {
                    cell.innerHTML = `<span style="color: var(--text-secondary); font-size: 0.85rem;">‚ùå Error</span>`;
                }
            }
        }
        
        // Content Management
        async function loadContent() {
            try {
                const response = await fetch('/api/v1/content/');
                const data = await response.json();
                const content = data.content || [];
                
                const container = document.getElementById('content-container');
                
                if (content.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h2>No Content Yet</h2>
                            <p>Generate your first piece of content to get started.</p>
                            <button class="btn btn-primary" onclick="generateContent()">
                                üé® Generate Content
                            </button>
                        </div>
                    `;
                    return;
                }
                
                // Sort content by created date (newest first)
                content.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                
                // Build content queue table
                let tableHTML = `
                    <div style="background: var(--dark-surface); border: 1px solid var(--border-color); border-radius: 12px; overflow: hidden;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--dark-card); border-bottom: 1px solid var(--border-color);">
                                    <th style="padding: 16px; text-align: left; font-weight: 600; color: var(--text-secondary); font-size: 0.85rem;">TYPE</th>
                                    <th style="padding: 16px; text-align: left; font-weight: 600; color: var(--text-secondary); font-size: 0.85rem;">TITLE</th>
                                    <th style="padding: 16px; text-align: left; font-weight: 600; color: var(--text-secondary); font-size: 0.85rem;">MODERATION</th>
                                    <th style="padding: 16px; text-align: left; font-weight: 600; color: var(--text-secondary); font-size: 0.85rem;">AGENT STATUS</th>
                                    <th style="padding: 16px; text-align: left; font-weight: 600; color: var(--text-secondary); font-size: 0.85rem;">QUALITY</th>
                                    <th style="padding: 16px; text-align: left; font-weight: 600; color: var(--text-secondary); font-size: 0.85rem;">CREATED</th>
                                    <th style="padding: 16px; text-align: center; font-weight: 600; color: var(--text-secondary); font-size: 0.85rem;">PUBLISHED</th>
                                    <th style="padding: 16px; text-align: center; font-weight: 600; color: var(--text-secondary); font-size: 0.85rem;">ACTIONS</th>
                                </tr>
                            </thead>
                            <tbody id="content-table-body">
                `;
                
                content.forEach(item => {
                    const qualityColor = item.quality_score >= 80 ? '#10b981' : item.quality_score >= 60 ? '#f59e0b' : '#ef4444';
                    const qualityDisplay = item.quality_score ? `<span style="color: ${qualityColor}; font-weight: 600;">${Math.round(item.quality_score)}</span>` : '<span style="color: var(--text-secondary);">N/A</span>';
                    const publishedIcon = item.is_published ? '<span style="color: #10b981; font-size: 1.2rem;">‚úÖ</span>' : '<span style="color: var(--text-secondary); font-size: 1.2rem;">‚≠ï</span>';
                    
                    tableHTML += `
                        <tr id="content-row-${item.id}" style="border-bottom: 1px solid var(--border-color); transition: background 0.2s;" onmouseover="this.style.background='var(--dark-card)'" onmouseout="this.style.background='transparent'">
                            <td style="padding: 16px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 1.5rem;">${getContentIcon(item.content_type)}</span>
                                    <span style="font-size: 0.85rem; font-weight: 600; text-transform: capitalize;">${item.content_type}</span>
                                </div>
                            </td>
                            <td style="padding: 16px;">
                                <div style="max-width: 300px;">
                                    <div style="font-weight: 600; margin-bottom: 4px;">${item.title || 'Untitled Content'}</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${item.description || 'No description'}</div>
                                </div>
                            </td>
                            <td style="padding: 16px;">
                                ${getStatusBadge(item.moderation_status)}
                            </td>
                            <td id="agent-status-${item.id}" style="padding: 16px;">
                                <span style="color: var(--text-secondary); font-size: 0.85rem;">‚è≥ Loading...</span>
                            </td>
                            <td style="padding: 16px; text-align: center; font-size: 1.1rem;">
                                ${qualityDisplay}
                            </td>
                            <td style="padding: 16px;">
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">${formatDate(item.created_at)}</div>
                            </td>
                            <td style="padding: 16px; text-align: center;">
                                ${publishedIcon}
                            </td>
                            <td style="padding: 16px; text-align: center;">
                                <button class="btn btn-secondary" onclick="viewContent('${item.id}')" style="padding: 8px 16px; font-size: 0.85rem;">
                                    üëÅÔ∏è View
                                </button>
                            </td>
                        </tr>
                    `;
                    
                    // Load agent status asynchronously
                    loadAgentStatus(item.id);
                });
                
                tableHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                container.innerHTML = tableHTML;
                
            } catch (error) {
                console.error('Failed to load content:', error);
                document.getElementById('content-container').innerHTML = `
                    <div class="empty-state">
                        <h2 style="color: #ef4444;">‚ùå Error Loading Content</h2>
                        <p>${error.message || 'Failed to load content list'}</p>
                        <button class="btn btn-primary" onclick="loadContent()">
                            üîÑ Retry
                        </button>
                    </div>
                `;
            }
        }
        
        async function generateContent() {
            try {
                // Load personas to show selection dialog
                const personasResponse = await fetch('/api/v1/personas/');
                const personasData = await personasResponse.json();
                const personas = personasData.personas || [];
                
                if (personas.length === 0) {
                    alert('‚ùå No personas available. Please create a persona first.');
                    return;
                }
                
                // Show persona selection dialog
                const personaOptions = personas.map(p => 
                    `<option value="${p.id}">${p.name} (${p.default_content_rating})</option>`
                ).join('');
                
                const dialogHtml = `
                    <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;" id="content-gen-modal">
                        <div style="background: var(--dark-card); padding: 32px; border-radius: 16px; max-width: 500px; width: 90%;">
                            <h2 style="margin-bottom: 24px; color: var(--text-primary);">Generate Content</h2>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 0.9rem;">Select Persona</label>
                                <select id="gen-persona-select" class="form-input" style="width: 100%;">
                                    ${personaOptions}
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 0.9rem;">Content Type</label>
                                <select id="gen-content-type" class="form-input" style="width: 100%;">
                                    <option value="image">Image</option>
                                    <option value="video">Video</option>
                                    <option value="text">Text</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 0.9rem;">Prompt (optional)</label>
                                <textarea id="gen-prompt" class="form-input" style="width: 100%; min-height: 80px;" placeholder="Leave blank to use auto-generated prompt based on persona..."></textarea>
                            </div>
                            
                            <div style="margin-bottom: 20px; padding: 12px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.3);">
                                <div style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 8px;">Persona Settings Will Be Used:</div>
                                <div id="persona-settings-preview" style="color: var(--text-primary); font-size: 0.9rem;">
                                    Select a persona to see settings...
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 12px; justify-content: flex-end;">
                                <button class="btn" onclick="document.getElementById('content-gen-modal').remove()" style="background: var(--dark-surface);">
                                    Cancel
                                </button>
                                <button class="btn btn-primary" onclick="executeContentGeneration()">
                                    üöÄ Generate
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', dialogHtml);
                
                // Update preview when persona changes
                const personaSelect = document.getElementById('gen-persona-select');
                const updatePreview = () => {
                    const selectedId = personaSelect.value;
                    const persona = personas.find(p => p.id === selectedId);
                    if (persona) {
                        const preview = document.getElementById('persona-settings-preview');
                        preview.innerHTML = `
                            <div>‚Ä¢ Content Rating: <strong>${persona.default_content_rating.toUpperCase()}</strong></div>
                            <div>‚Ä¢ Image Resolution: <strong>${persona.default_image_resolution || '1024x1024'}</strong></div>
                            <div>‚Ä¢ Video Resolution: <strong>${persona.default_video_resolution || '1920x1080'}</strong></div>
                            <div>‚Ä¢ Quality: <strong>${persona.generation_quality || 'standard'}</strong></div>
                            <div>‚Ä¢ Image Style: <strong>${persona.image_style || 'photorealistic'}</strong></div>
                            ${persona.nsfw_model_preference ? `<div>‚Ä¢ NSFW Model: <strong>${persona.nsfw_model_preference}</strong></div>` : ''}
                        `;
                    }
                };
                personaSelect.addEventListener('change', updatePreview);
                updatePreview();
                
            } catch (error) {
                console.error('Failed to load personas:', error);
                alert('‚ùå Failed to load personas');
            }
        }
        
        async function executeContentGeneration() {
            const personaId = document.getElementById('gen-persona-select').value;
            const contentType = document.getElementById('gen-content-type').value;
            const prompt = document.getElementById('gen-prompt').value.trim();
            
            // Close modal
            document.getElementById('content-gen-modal').remove();
            
            try {
                const requestBody = {
                    persona_id: personaId,
                    content_type: contentType
                };
                
                if (prompt) {
                    requestBody.prompt = prompt;
                }
                
                const response = await fetch('/api/v1/content/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                
                if (response.ok) {
                    alert('‚úÖ Content generation started! Persona settings will be applied.');
                    setTimeout(loadContent, 2000);
                } else {
                    const error = await response.json();
                    alert(`‚ùå Failed to generate content: ${error.detail || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('Generation error:', error);
                alert('‚ùå Failed to generate content');
            }
        }
        
        async function generateContentForAll() {
            // Show dialog to select content type
            const dialogHtml = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;" id="batch-gen-modal">
                    <div style="background: var(--dark-card); padding: 32px; border-radius: 16px; max-width: 500px; width: 90%;">
                        <h2 style="margin-bottom: 24px; color: var(--text-primary);">Batch Generate for All Personas</h2>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 0.9rem;">Content Type</label>
                            <select id="batch-content-type" class="form-input" style="width: 100%;">
                                <option value="image">Image</option>
                                <option value="video">Video</option>
                                <option value="text">Text</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px; padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3);">
                            <div style="color: var(--text-primary); font-size: 0.9rem; margin-bottom: 8px;">‚ÑπÔ∏è Batch Generation Behavior:</div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem; line-height: 1.5;">
                                ‚Ä¢ Each persona will use their own settings<br>
                                ‚Ä¢ Content rating from persona (SFW/NSFW)<br>
                                ‚Ä¢ Resolution from persona preferences<br>
                                ‚Ä¢ Quality level from persona settings<br>
                                ‚Ä¢ NSFW models applied automatically<br>
                                ‚Ä¢ This may take several minutes
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <button class="btn" onclick="document.getElementById('batch-gen-modal').remove()" style="background: var(--dark-surface);">
                                Cancel
                            </button>
                            <button class="btn btn-primary" onclick="executeBatchGeneration()">
                                üöÄ Generate for All
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', dialogHtml);
        }
        
        async function executeBatchGeneration() {
            const contentType = document.getElementById('batch-content-type').value;
            
            // Close modal
            document.getElementById('batch-gen-modal').remove();
            
            if (!confirm(`Generate ${contentType} content for all active personas?\n\nEach persona will use their own settings (rating, resolution, quality, NSFW models).\n\nThis may take several minutes.`)) {
                return;
            }
            
            try {
                // Show loading message
                const loadingDiv = document.createElement('div');
                loadingDiv.id = 'batch-loading';
                loadingDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; background: var(--dark-card); padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.5); z-index: 9999; border: 2px solid var(--primary);';
                loadingDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="font-size: 1.5rem;">‚è≥</div>
                        <div>
                            <div style="font-weight: 600; color: var(--text-primary);">Batch Generation Running</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Generating ${contentType} for all personas...</div>
                        </div>
                    </div>
                `;
                document.body.appendChild(loadingDiv);
                
                // Note: We removed hardcoded quality and content_rating parameters
                // Now each persona will use their own settings
                const response = await fetch(`/api/v1/content/generate/all?content_type=${contentType}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                // Remove loading indicator
                if (document.getElementById('batch-loading')) {
                    document.getElementById('batch-loading').remove();
                }
                
                if (response.ok) {
                    const result = await response.json();
                    const details = result.details;
                    alert(`‚úÖ Batch generation completed!\n\nGenerated: ${details.generated}\nFailed: ${details.failed}\nTotal: ${details.total_personas}\n\nEach persona used their own settings.`);
                    setTimeout(loadContent, 2000);
                } else {
                    const error = await response.json();
                    alert(`‚ùå Failed to generate content: ${error.detail || 'Unknown error'}`);
                }
                
            } catch (error) {
                console.error('Batch generation error:', error);
                if (document.getElementById('batch-loading')) {
                    document.getElementById('batch-loading').remove();
                }
                alert('‚ùå Failed to generate content for all personas');
            }
        }
        
        function viewContent(id) {
            window.location.href = `/admin/content/view?id=${id}`;
        }
        
        // Load on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadContent();
        });
    </script>
</body>
</html>
