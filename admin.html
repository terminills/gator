<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gator AI - Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .nav-tabs {
            display: flex;
            gap: 20px;
            list-style: none;
        }
        
        .nav-tabs li {
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .nav-tabs li:hover, .nav-tabs li.active {
            background: rgba(255,255,255,0.2);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-icon {
            font-size: 2rem;
            margin-right: 15px;
        }
        
        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }
        
        .card-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(102,126,234,0.4);
        }
        
        .btn-secondary {
            background: #e9ecef;
            color: #495057;
        }
        
        .btn-secondary:hover {
            background: #dee2e6;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102,126,234,0.2);
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .dns-record {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .record-info {
            flex: 1;
        }
        
        .record-name {
            font-weight: 600;
            color: #333;
        }
        
        .record-details {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .record-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-active {
            background: #28a745;
        }
        
        .status-inactive {
            background: #dc3545;
        }
        
        .status-pending {
            background: #ffc107;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-radius: 50%;
            border-top: 2px solid #667eea;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Gator Chat Styles */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 600px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .chat-header {
            background: linear-gradient(135deg, #2c5530 0%, #3d7c3d 100%);
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }
        
        .chat-message {
            margin-bottom: 15px;
            max-width: 80%;
        }
        
        .chat-message.user {
            margin-left: auto;
        }
        
        .chat-message.gator {
            margin-right: auto;
        }
        
        .message-content {
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .chat-message.user .message-content {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .chat-message.gator .message-content {
            background: #2c5530;
            color: white;
            border-bottom-left-radius: 4px;
            border: 2px solid #3d7c3d;
        }
        
        .message-author {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .chat-message.user .message-author {
            text-align: right;
        }
        
        .chat-message.gator .message-author {
            text-align: left;
        }
        
        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #eee;
        }
        
        .chat-input-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 20px;
            outline: none;
            font-size: 14px;
        }
        
        .chat-input:focus {
            border-color: #2c5530;
            box-shadow: 0 0 0 2px rgba(44, 85, 48, 0.2);
        }
        
        .chat-send-btn {
            background: #2c5530;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .chat-send-btn:hover {
            background: #3d7c3d;
            transform: translateY(-1px);
        }
        
        .chat-send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .quick-help-topics {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .quick-help-btn {
            background: #f8f9fa;
            border: 1px solid #2c5530;
            color: #2c5530;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .quick-help-btn:hover {
            background: #2c5530;
            color: white;
        }
        
        .chat-typing {
            display: none;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            color: #666;
            font-size: 14px;
            font-style: italic;
        }
        
        .typing-dots {
            display: flex;
            gap: 3px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #2c5530;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out both;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        .typing-dot:nth-child(3) { animation-delay: 0; }
        
        @keyframes typing {
            0%, 80%, 100% { 
                transform: scale(0);
                opacity: 0.5;
            } 
            40% { 
                transform: scale(1);
                opacity: 1;
            }
        }
        
        /* Persona and Content Grid Styles */
        .personas-grid, .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .persona-card, .content-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .persona-card:hover, .content-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .persona-header, .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .persona-header h4 {
            margin: 0;
            color: #333;
            font-size: 1.2rem;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-badge.active {
            background: #d4edda;
            color: #155724;
        }
        
        .status-badge.inactive {
            background: #f8d7da;
            color: #721c24;
        }
        
        .persona-personality {
            color: #666;
            line-height: 1.5;
            margin-bottom: 12px;
        }
        
        .persona-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 12px;
            font-size: 0.9rem;
            color: #777;
        }
        
        .persona-actions, .content-actions {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }
        
        .content-type {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .content-rating {
            background: #f0f0f0;
            color: #333;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .content-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 6px;
            margin: 12px 0;
        }
        
        .content-text {
            color: #666;
            line-height: 1.5;
            margin-bottom: 12px;
        }
        
        .error {
            color: #d9534f;
            padding: 20px;
            text-align: center;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            margin: 20px;
            padding: 0;
            border-radius: 10px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            animation: slideIn 0.3s;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .modal-close {
            font-size: 28px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            border-radius: 50%;
            transition: background 0.3s;
        }
        
        .modal-close:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { 
                transform: translateY(-50px);
                opacity: 0;
            }
            to { 
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .form-section {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid #eee;
        }
        
        .form-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .form-section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-row.full-width {
            grid-template-columns: 1fr;
        }
        
        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }
        
        .chip-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .chip {
            background: #667eea;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .chip-remove {
            cursor: pointer;
            font-weight: bold;
        }
        
        .platform-restriction-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .platform-restriction-item input,
        .platform-restriction-item select {
            flex: 1;
        }
        
        .platform-restriction-item button {
            flex-shrink: 0;
        }
        
        .image-preview-container {
            margin-top: 15px;
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }
        
        .image-preview.show {
            display: block;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        
        .help-text {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">ü¶é Gator - Don't Play No Shit</div>
            <ul class="nav-tabs">
                <li class="tab-link active" data-tab="dashboard">Dashboard</li>
                <li class="tab-link" data-tab="personas">Personas</li>
                <li class="tab-link" data-tab="content">Content</li>
                <li class="tab-link" data-tab="feeds">RSS Feeds</li>
                <li class="tab-link" data-tab="social">Social Media</li>
                <li class="tab-link" data-tab="messaging">Messaging</li>
                <li class="tab-link" data-tab="users">Users</li>
                <li class="tab-link" data-tab="analytics">Analytics</li>
                <li class="tab-link" data-tab="dns">DNS</li>
                <li class="tab-link" data-tab="settings">Settings</li>
                <li class="tab-link" data-tab="database">Database</li>
                <li class="tab-link" data-tab="gator-help">üêä Ask Gator</li>
            </ul>
        </div>
    </div>
    
    <div class="container">
        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üìä</div>
                        <div>
                            <div class="card-title">System Status</div>
                        </div>
                    </div>
                    <div class="card-description">
                        Monitor platform health and performance metrics
                    </div>
                    <button class="btn" onclick="checkSystemStatus()">Check Status</button>
                    <div id="system-status" class="mt-3"></div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üé≠</div>
                        <div>
                            <div class="card-title">AI Personas</div>
                        </div>
                    </div>
                    <div class="card-description">
                        Manage your AI influencer personas and their characteristics
                    </div>
                    <button class="btn" onclick="showTab('personas')">Manage Personas</button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üé®</div>
                        <div>
                            <div class="card-title">Generated Content</div>
                        </div>
                    </div>
                    <div class="card-description">
                        View and manage AI-generated images, videos, and text content
                    </div>
                    <button class="btn" onclick="showTab('content')">View Content</button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üåê</div>
                        <div>
                            <div class="card-title">DNS Management</div>
                        </div>
                    </div>
                    <div class="card-description">
                        Configure domain names and DNS records through GoDaddy
                    </div>
                    <button class="btn" onclick="showTab('dns')">Manage DNS</button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üì°</div>
                        <div>
                            <div class="card-title">RSS Feeds</div>
                        </div>
                    </div>
                    <div class="card-description">
                        Monitor RSS feeds for trending topics and content inspiration
                    </div>
                    <button class="btn" onclick="showTab('feeds')">Manage Feeds</button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üì±</div>
                        <div>
                            <div class="card-title">Social Media</div>
                        </div>
                    </div>
                    <div class="card-description">
                        Publish content to social media platforms and track engagement
                    </div>
                    <button class="btn" onclick="showTab('social')">Social Media</button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üí¨</div>
                        <div>
                            <div class="card-title">Direct Messaging</div>
                        </div>
                    </div>
                    <div class="card-description">
                        Manage persona conversations and PPV content offers
                    </div>
                    <button class="btn" onclick="showTab('messaging')">View Messages</button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üë•</div>
                        <div>
                            <div class="card-title">Users</div>
                        </div>
                    </div>
                    <div class="card-description">
                        Manage user accounts and engagement tracking
                    </div>
                    <button class="btn" onclick="showTab('users')">Manage Users</button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üìà</div>
                        <div>
                            <div class="card-title">Creator Analytics</div>
                        </div>
                    </div>
                    <div class="card-description">
                        View performance metrics and optimization suggestions
                    </div>
                    <button class="btn" onclick="showTab('analytics')">View Analytics</button>
                </div>
            </div>
        </div>
        
        <!-- Personas Tab -->
        <div class="tab-content" id="personas">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üé≠</div>
                    <div class="card-title">AI Personas</div>
                </div>
                <div class="card-description">
                    Create and manage AI influencer personas. Each persona defines the appearance, personality, and content style for your AI influencer.
                </div>
                <button class="btn" onclick="createPersona()">Create New Persona</button>
                <button class="btn btn-secondary" onclick="loadPersonas()">Refresh List</button>
                <div id="personas-list" class="mt-3"></div>
            </div>
        </div>
        
        <!-- Content Tab -->
        <div class="tab-content" id="content">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üé®</div>
                    <div class="card-title">Generated Content</div>
                </div>
                <div class="card-description">
                    Browse and manage all AI-generated content. Content is organized by persona and generation date.
                </div>
                <button class="btn" onclick="generateContent()">Generate New Content</button>
                <button class="btn btn-secondary" onclick="loadContent()">Refresh Content</button>
                <div id="content-list" class="mt-3"></div>
            </div>
        </div>
        
        <!-- RSS Feeds Tab -->
        <div class="tab-content" id="feeds">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üì°</div>
                    <div class="card-title">RSS Feed Management</div>
                </div>
                <div class="card-description">
                    Monitor RSS feeds for trending topics and generate content based on current trends.
                </div>
                <button class="btn" onclick="addRSSFeed()">Add New Feed</button>
                <button class="btn btn-secondary" onclick="loadRSSFeeds()">Refresh Feeds</button>
                <button class="btn btn-secondary" onclick="fetchAllFeeds()">Fetch All</button>
                <div id="feeds-list" class="mt-3"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üî•</div>
                    <div class="card-title">Trending Topics</div>
                </div>
                <div class="card-description">
                    Current trending topics across all monitored feeds.
                </div>
                <button class="btn" onclick="loadTrendingTopics()">Load Trending</button>
                <div id="trending-list" class="mt-3"></div>
            </div>
        </div>
        
        <!-- Social Media Tab -->
        <div class="tab-content" id="social">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üì±</div>
                    <div class="card-title">Social Media Accounts</div>
                </div>
                <div class="card-description">
                    Connect and manage social media accounts for content publishing.
                </div>
                <button class="btn" onclick="addSocialAccount()">Add Account</button>
                <button class="btn btn-secondary" onclick="loadSocialAccounts()">Refresh</button>
                <div id="social-accounts-list" class="mt-3"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üì§</div>
                    <div class="card-title">Publish Content</div>
                </div>
                <div class="card-description">
                    Publish or schedule content across social media platforms.
                </div>
                <div class="form-group">
                    <label class="form-label">Select Content</label>
                    <select class="form-control" id="social-content-select">
                        <option>Select content to publish...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Select Platforms</label>
                    <select class="form-control" id="social-platform-select" multiple>
                        <option value="facebook">Facebook</option>
                        <option value="instagram">Instagram</option>
                        <option value="twitter">Twitter</option>
                    </select>
                </div>
                <button class="btn" onclick="publishToSocial()">Publish Now</button>
                <button class="btn btn-secondary" onclick="scheduleToSocial()">Schedule</button>
            </div>
        </div>
        
        <!-- Direct Messaging Tab -->
        <div class="tab-content" id="messaging">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üí¨</div>
                    <div class="card-title">Conversation Queue</div>
                </div>
                <div class="card-description">
                    Manage pending conversations in the round-robin queue.
                </div>
                <button class="btn" onclick="getNextConversation()">Get Next</button>
                <button class="btn btn-secondary" onclick="viewQueueStatus()">Queue Status</button>
                <div id="conversation-queue" class="mt-3"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üí∞</div>
                    <div class="card-title">PPV Offers</div>
                </div>
                <div class="card-description">
                    Create and manage pay-per-view content offers.
                </div>
                <button class="btn" onclick="createPPVOffer()">Create Offer</button>
                <button class="btn btn-secondary" onclick="loadPPVOffers()">View Offers</button>
                <div id="ppv-offers-list" class="mt-3"></div>
            </div>
        </div>
        
        <!-- Users Tab -->
        <div class="tab-content" id="users">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üë•</div>
                    <div class="card-title">User Management</div>
                </div>
                <div class="card-description">
                    View and manage user accounts and engagement metrics.
                </div>
                <button class="btn" onclick="createUser()">Create User</button>
                <button class="btn btn-secondary" onclick="loadUsers()">Refresh List</button>
                <div id="users-list" class="mt-3"></div>
            </div>
        </div>
        
        <!-- Analytics Tab -->
        <div class="tab-content" id="analytics">
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üìä</div>
                        <div class="card-title">Platform Metrics</div>
                    </div>
                    <div class="card-description">
                        Overall platform performance and usage metrics.
                    </div>
                    <button class="btn" onclick="loadPlatformMetrics()">Load Metrics</button>
                    <div id="platform-metrics" class="mt-3"></div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">ü§ñ</div>
                        <div class="card-title">AI Model Setup</div>
                    </div>
                    <div class="card-description">
                        Install and configure AI models for content generation and messaging.
                    </div>
                    <a href="/ai-models-setup" class="btn" style="text-decoration: none; display: inline-block;">Configure AI Models</a>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üìà</div>
                        <div class="card-title">Creator Dashboard</div>
                    </div>
                    <div class="card-description">
                        Performance stats and optimization suggestions.
                    </div>
                    <button class="btn" onclick="loadCreatorDashboard()">Load Dashboard</button>
                    <div id="creator-dashboard" class="mt-3"></div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üéØ</div>
                        <div class="card-title">Persona Analytics</div>
                    </div>
                    <div class="card-description">
                        Individual persona performance analysis.
                    </div>
                    <div class="form-group">
                        <label class="form-label">Select Persona</label>
                        <select class="form-control" id="analytics-persona-select">
                            <option>Select a persona...</option>
                        </select>
                    </div>
                    <button class="btn" onclick="loadPersonaAnalytics()">Load Analytics</button>
                    <div id="persona-analytics" class="mt-3"></div>
                </div>
            </div>
        </div>
        
        <!-- DNS Management Tab -->
        <div class="tab-content" id="dns">
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üåê</div>
                        <div class="card-title">Domain Information</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Domain Name</label>
                        <input type="text" class="form-control" id="domain-input" placeholder="example.com">
                    </div>
                    <button class="btn" onclick="loadDomainInfo()">Load Domain Info</button>
                    <div id="domain-info" class="mt-3"></div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">‚ö°</div>
                        <div class="card-title">Quick Setup</div>
                    </div>
                    <div class="card-description">
                        Automatically configure DNS records for your Gator platform
                    </div>
                    <div class="form-group">
                        <label class="form-label">Domain</label>
                        <input type="text" class="form-control" id="setup-domain" placeholder="yourdomain.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Server IP</label>
                        <input type="text" class="form-control" id="setup-ip" placeholder="192.168.1.100">
                    </div>
                    <button class="btn" onclick="setupPlatformDNS()">Setup Platform DNS</button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üìù</div>
                    <div class="card-title">DNS Records</div>
                </div>
                <div class="card-description">
                    Manage individual DNS records for your domain
                </div>
                <button class="btn" onclick="showAddRecordForm()">Add DNS Record</button>
                
                <div id="add-record-form" class="hidden mt-3">
                    <div class="form-group">
                        <label class="form-label">Record Name</label>
                        <input type="text" class="form-control" id="record-name" placeholder="www">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Record Type</label>
                        <select class="form-control" id="record-type">
                            <option value="A">A Record</option>
                            <option value="CNAME">CNAME</option>
                            <option value="MX">MX</option>
                            <option value="TXT">TXT</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Record Value</label>
                        <input type="text" class="form-control" id="record-value" placeholder="192.168.1.100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">TTL (seconds)</label>
                        <input type="number" class="form-control" id="record-ttl" value="3600">
                    </div>
                    <button class="btn" onclick="addDNSRecord()">Add Record</button>
                    <button class="btn btn-secondary" onclick="hideAddRecordForm()">Cancel</button>
                </div>
                
                <div id="dns-records" class="mt-3"></div>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div class="tab-content" id="settings">
            <div class="dashboard-grid">
                <!-- Initial System Setup Card -->
                <div class="card" style="grid-column: span 2;">
                    <div class="card-header">
                        <div class="card-icon">‚öôÔ∏è</div>
                        <div class="card-title">System Setup Wizard</div>
                    </div>
                    <div class="card-description">
                        Configure your Gator platform environment variables. Changes require application restart.
                    </div>
                    
                    <!-- Setup Status -->
                    <div id="setup-status-section" class="mb-3">
                        <h3 style="margin-top: 1rem; margin-bottom: 0.5rem;">Configuration Status</h3>
                        <div id="setup-status-display" style="padding: 1rem; background: #f5f5f5; border-radius: 4px;">
                            <p style="margin: 0;">Loading configuration status...</p>
                        </div>
                    </div>
                    
                    <!-- Setup Form Sections -->
                    <div class="setup-sections">
                        <!-- Database Configuration -->
                        <div class="setup-section">
                            <h3 style="margin-top: 1.5rem; margin-bottom: 0.5rem; color: #333;">Database Configuration</h3>
                            <div class="form-group">
                                <label class="form-label">Database URL</label>
                                <input type="text" class="form-control" id="setup-database-url" 
                                       placeholder="postgresql://user:password@localhost:5432/gator_dev">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Redis URL</label>
                                <input type="text" class="form-control" id="setup-redis-url" 
                                       placeholder="redis://localhost:6379/0">
                            </div>
                        </div>
                        
                        <!-- Security Configuration -->
                        <div class="setup-section">
                            <h3 style="margin-top: 1.5rem; margin-bottom: 0.5rem; color: #333;">Security Configuration</h3>
                            <div class="form-group">
                                <label class="form-label">Secret Key (required)</label>
                                <input type="password" class="form-control" id="setup-secret-key" 
                                       placeholder="Enter a strong secret key">
                            </div>
                            <div class="form-group">
                                <label class="form-label">JWT Secret (required)</label>
                                <input type="password" class="form-control" id="setup-jwt-secret" 
                                       placeholder="Enter JWT secret key">
                            </div>
                        </div>
                        
                        <!-- AI Model Configuration -->
                        <div class="setup-section">
                            <h3 style="margin-top: 1.5rem; margin-bottom: 0.5rem; color: #333;">AI Model Configuration</h3>
                            <div class="form-group">
                                <label class="form-label">OpenAI API Key</label>
                                <input type="password" class="form-control" id="setup-openai-key" 
                                       placeholder="sk-...">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Anthropic API Key</label>
                                <input type="password" class="form-control" id="setup-anthropic-key" 
                                       placeholder="sk-ant-...">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Hugging Face Token</label>
                                <input type="password" class="form-control" id="setup-huggingface-token" 
                                       placeholder="hf_...">
                            </div>
                        </div>
                        
                        <!-- Social Media APIs -->
                        <div class="setup-section">
                            <h3 style="margin-top: 1.5rem; margin-bottom: 0.5rem; color: #333;">Social Media APIs</h3>
                            <div class="form-group">
                                <label class="form-label">Facebook API Key</label>
                                <input type="password" class="form-control" id="setup-facebook-key" 
                                       placeholder="Facebook API Key">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Instagram API Key</label>
                                <input type="password" class="form-control" id="setup-instagram-key" 
                                       placeholder="Instagram API Key">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Twitter API Key</label>
                                <input type="password" class="form-control" id="setup-twitter-key" 
                                       placeholder="Twitter API Key">
                            </div>
                        </div>
                        
                        <!-- DNS Management -->
                        <div class="setup-section">
                            <h3 style="margin-top: 1.5rem; margin-bottom: 0.5rem; color: #333;">DNS Management (GoDaddy)</h3>
                            <div class="form-group">
                                <label class="form-label">GoDaddy API Key</label>
                                <input type="password" class="form-control" id="setup-godaddy-key" 
                                       placeholder="GoDaddy API Key">
                            </div>
                            <div class="form-group">
                                <label class="form-label">GoDaddy API Secret</label>
                                <input type="password" class="form-control" id="setup-godaddy-secret" 
                                       placeholder="GoDaddy API Secret">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Default Domain</label>
                                <input type="text" class="form-control" id="setup-default-domain" 
                                       placeholder="yourdomain.com">
                            </div>
                        </div>
                        
                        <!-- Application Settings -->
                        <div class="setup-section">
                            <h3 style="margin-top: 1.5rem; margin-bottom: 0.5rem; color: #333;">Application Settings</h3>
                            <div class="form-group">
                                <label class="form-label">Environment</label>
                                <select class="form-control" id="setup-environment">
                                    <option value="development">Development</option>
                                    <option value="staging">Staging</option>
                                    <option value="production">Production</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Debug Mode</label>
                                <select class="form-control" id="setup-debug">
                                    <option value="true">Enabled</option>
                                    <option value="false">Disabled</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Log Level</label>
                                <select class="form-control" id="setup-log-level">
                                    <option value="DEBUG">DEBUG</option>
                                    <option value="INFO">INFO</option>
                                    <option value="WARNING">WARNING</option>
                                    <option value="ERROR">ERROR</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div style="margin-top: 2rem; display: flex; gap: 1rem;">
                        <button class="btn" onclick="loadSetupStatus()">Refresh Status</button>
                        <button class="btn" onclick="saveSetupConfiguration()" style="background: #22c55e;">Save Configuration</button>
                        <button class="btn btn-secondary" onclick="resetSetupForm()">Reset Form</button>
                    </div>
                    
                    <!-- Result Display -->
                    <div id="setup-result" style="margin-top: 1rem;"></div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üîë</div>
                        <div class="card-title">GoDaddy API Configuration</div>
                    </div>
                    <div class="card-description">
                        Configure your GoDaddy API credentials for DNS management
                    </div>
                    <div class="form-group">
                        <label class="form-label">API Key</label>
                        <input type="text" class="form-control" id="godaddy-key" placeholder="Your GoDaddy API Key">
                    </div>
                    <div class="form-group">
                        <label class="form-label">API Secret</label>
                        <input type="password" class="form-control" id="godaddy-secret" placeholder="Your GoDaddy API Secret">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Environment</label>
                        <select class="form-control" id="godaddy-env">
                            <option value="production">Production</option>
                            <option value="ote">OTE (Testing)</option>
                        </select>
                    </div>
                    <button class="btn" onclick="saveGoDaddyConfig()">Save Configuration</button>
                    <button class="btn btn-secondary" onclick="testGoDaddyConnection()">Test Connection</button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">‚öôÔ∏è</div>
                        <div class="card-title">System Settings</div>
                    </div>
                    <div class="card-description">
                        Configure general platform settings
                    </div>
                    <div class="form-group">
                        <label class="form-label">Default Domain</label>
                        <input type="text" class="form-control" id="default-domain" placeholder="yourdomain.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Platform Environment</label>
                        <select class="form-control" id="platform-env">
                            <option value="development">Development</option>
                            <option value="staging">Staging</option>
                            <option value="production">Production</option>
                        </select>
                    </div>
                    <button class="btn" onclick="saveSystemSettings()">Save Settings</button>
                </div>
            </div>
        </div>
        
        <!-- Database Management Tab -->
        <div class="tab-content" id="database">
            <h2 style="margin-bottom: 1.5rem;">Database Management</h2>
            
            <!-- Database Info Card -->
            <div class="card" style="margin-bottom: 25px;">
                <div class="card-header">
                    <div class="card-icon">üíæ</div>
                    <div class="card-title">Database Information</div>
                </div>
                <div class="card-description">
                    Current database status and configuration
                </div>
                <div id="database-info-content">
                    <p style="color: #666;">Loading database information...</p>
                </div>
            </div>
            
            <!-- Schema Sync Card -->
            <div class="card" style="margin-bottom: 25px;">
                <div class="card-header">
                    <div class="card-icon">üîÑ</div>
                    <div class="card-title">Schema Synchronization</div>
                </div>
                <div class="card-description">
                    Keep your database schema in sync with the current codebase
                </div>
                <div id="schema-status-content">
                    <p style="color: #666;">Loading schema status...</p>
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="checkSchemaStatus()" style="margin-right: 10px;">
                        üîç Check Schema Status
                    </button>
                    <button class="btn" onclick="syncDatabaseSchema()">
                        ‚ö° Sync Schema Now
                    </button>
                </div>
            </div>
            
            <!-- Database Backup Card -->
            <div class="card" style="margin-bottom: 25px;">
                <div class="card-header">
                    <div class="card-icon">üíø</div>
                    <div class="card-title">Database Backup</div>
                </div>
                <div class="card-description">
                    Create and manage database backups
                </div>
                <div style="margin-top: 20px; margin-bottom: 20px;">
                    <button class="btn" onclick="createDatabaseBackup()">
                        üì¶ Create Backup Now
                    </button>
                </div>
                <div id="backup-status" style="margin-bottom: 20px;">
                    <!-- Backup creation status will appear here -->
                </div>
                <div>
                    <h3 style="margin-bottom: 10px; color: #333;">Available Backups</h3>
                    <div id="backups-list">
                        <p style="color: #666;">Loading backups...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Gator Help Tab -->
        <div class="tab-content" id="gator-help">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üêä</div>
                    <div class="card-title">Ask Gator - Your AI Help Agent</div>
                </div>
                <div class="card-description">
                    Need help? Gator's here to guide you through the platform. He don't play no shit and he'll get you sorted out.
                </div>
                
                <div id="quick-help-section" class="quick-help-topics">
                    <!-- Quick help buttons will be loaded here -->
                </div>
                
                <div class="chat-container">
                    <div class="chat-header">
                        <span>üêä</span>
                        <span>Gator - Platform Help Agent</span>
                        <div style="margin-left: auto; font-size: 12px; opacity: 0.8;">
                            No-nonsense help when you need it
                        </div>
                    </div>
                    
                    <div class="chat-messages" id="chat-messages">
                        <div class="chat-message gator">
                            <div class="message-author">Gator</div>
                            <div class="message-content">
                                Alright, listen up! I'm Gator, your platform help agent. I don't have time for games, so tell me what you need help with and I'll get you sorted. What's the problem?
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-typing" id="chat-typing">
                        <span>Gator is thinking</span>
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <form class="chat-input-form" id="chat-form">
                            <input 
                                type="text" 
                                class="chat-input" 
                                id="chat-input" 
                                placeholder="Ask Gator anything about the platform..."
                                maxlength="500"
                            />
                            <button type="submit" class="chat-send-btn" id="chat-send-btn">
                                Send
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Tab management
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab links
            document.querySelectorAll('.tab-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab link
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        }
        
        // Tab click handlers
        document.querySelectorAll('.tab-link').forEach(link => {
            link.addEventListener('click', () => {
                const tabName = link.dataset.tab;
                showTab(tabName);
            });
        });
        
        // API helper function
        async function apiRequest(endpoint, options = {}) {
            try {
                const response = await fetch(endpoint, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API request failed:', error);
                throw error;
            }
        }
        
        // Show alert message
        function showAlert(message, type = 'success') {
            const alertClass = type === 'error' ? 'alert-error' : 'alert-success';
            const alertHtml = `<div class="alert ${alertClass}">${message}</div>`;
            
            // Find the nearest container to show the alert
            const activeTab = document.querySelector('.tab-content.active');
            if (activeTab) {
                activeTab.insertAdjacentHTML('afterbegin', alertHtml);
                
                // Remove alert after 5 seconds
                setTimeout(() => {
                    const alert = activeTab.querySelector('.alert');
                    if (alert) alert.remove();
                }, 5000);
            }
        }
        
        // System status check
        async function checkSystemStatus() {
            const statusDiv = document.getElementById('system-status');
            statusDiv.innerHTML = '<div class="loading"></div>Checking system status...';
            
            try {
                const response = await apiRequest('/health');
                const status = response.status === 'healthy' ? 'active' : 'inactive';
                statusDiv.innerHTML = `
                    <div class="status-indicator status-${status}"></div>
                    System Status: ${response.status}
                `;
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="status-indicator status-inactive"></div>
                    System Status: Error - ${error.message}
                `;
            }
        }
        
        // DNS Management Functions
        async function loadDomainInfo() {
            const domain = document.getElementById('domain-input').value.trim();
            if (!domain) {
                showAlert('Please enter a domain name', 'error');
                return;
            }
            
            const infoDiv = document.getElementById('domain-info');
            infoDiv.innerHTML = '<div class="loading"></div>Loading domain information...';
            
            try {
                const data = await apiRequest(`/api/v1/dns/domain/${domain}`);
                
                let recordsHtml = '';
                data.records.forEach(record => {
                    recordsHtml += `
                        <div class="dns-record">
                            <div class="record-info">
                                <div class="record-name">${record.name}.${domain}</div>
                                <div class="record-details">${record.type} ‚Üí ${record.data} (TTL: ${record.ttl})</div>
                            </div>
                            <div class="record-actions">
                                <button class="btn btn-sm" onclick="editRecord('${record.name}', '${record.type}')">Edit</button>
                                <button class="btn btn-sm btn-secondary" onclick="deleteRecord('${record.name}', '${record.type}')">Delete</button>
                            </div>
                        </div>
                    `;
                });
                
                infoDiv.innerHTML = `
                    <h4>Domain: ${data.domain}</h4>
                    <p>Status: ${data.status} | Provider: ${data.provider}</p>
                    ${data.expires ? `<p>Expires: ${new Date(data.expires).toLocaleDateString()}</p>` : ''}
                    <h5>DNS Records:</h5>
                    ${recordsHtml || '<p>No DNS records found.</p>'}
                `;
            } catch (error) {
                infoDiv.innerHTML = `<div class="alert alert-error">Failed to load domain info: ${error.message}</div>`;
            }
        }
        
        async function setupPlatformDNS() {
            const domain = document.getElementById('setup-domain').value.trim();
            const serverIp = document.getElementById('setup-ip').value.trim();
            
            if (!domain || !serverIp) {
                showAlert('Please enter both domain and server IP', 'error');
                return;
            }
            
            try {
                const response = await apiRequest('/api/v1/dns/setup-platform', {
                    method: 'POST',
                    body: JSON.stringify({
                        domain: domain,
                        server_ip: serverIp,
                        provider: 'godaddy'
                    })
                });
                
                showAlert(`Platform DNS setup completed for ${domain}!`);
                
                // Clear form
                document.getElementById('setup-domain').value = '';
                document.getElementById('setup-ip').value = '';
                
                // Auto-load domain info if it's the same domain
                const domainInput = document.getElementById('domain-input');
                if (!domainInput.value) {
                    domainInput.value = domain;
                    await loadDomainInfo();
                }
                
            } catch (error) {
                showAlert(`Failed to setup platform DNS: ${error.message}`, 'error');
            }
        }
        
        function showAddRecordForm() {
            document.getElementById('add-record-form').classList.remove('hidden');
        }
        
        function hideAddRecordForm() {
            document.getElementById('add-record-form').classList.add('hidden');
            // Clear form
            document.getElementById('record-name').value = '';
            document.getElementById('record-value').value = '';
            document.getElementById('record-ttl').value = '3600';
        }
        
        async function addDNSRecord() {
            const domain = document.getElementById('domain-input').value.trim();
            const name = document.getElementById('record-name').value.trim();
            const type = document.getElementById('record-type').value;
            const value = document.getElementById('record-value').value.trim();
            const ttl = document.getElementById('record-ttl').value;
            
            if (!domain || !name || !value) {
                showAlert('Please fill in all required fields', 'error');
                return;
            }
            
            try {
                const response = await apiRequest(`/api/v1/dns/domain/${domain}/records`, {
                    method: 'POST',
                    body: JSON.stringify({
                        name: name,
                        type: type,
                        data: value,
                        ttl: parseInt(ttl)
                    })
                });
                
                showAlert(`DNS record added successfully!`);
                hideAddRecordForm();
                await loadDomainInfo(); // Refresh domain info
                
            } catch (error) {
                showAlert(`Failed to add DNS record: ${error.message}`, 'error');
            }
        }
        
        // Settings functions
        function saveGoDaddyConfig() {
            const key = document.getElementById('godaddy-key').value.trim();
            const secret = document.getElementById('godaddy-secret').value.trim();
            const env = document.getElementById('godaddy-env').value;
            
            if (!key || !secret) {
                showAlert('Please enter both API key and secret', 'error');
                return;
            }
            
            // In a real implementation, this would save to backend
            localStorage.setItem('godaddy_config', JSON.stringify({key, secret, env}));
            showAlert('GoDaddy configuration saved!');
        }
        
        async function testGoDaddyConnection() {
            try {
                const response = await apiRequest('/api/v1/dns/providers');
                const godaddyProvider = response.providers.find(p => p.provider === 'godaddy');
                
                if (godaddyProvider && godaddyProvider.configured) {
                    showAlert('GoDaddy connection test successful!');
                } else {
                    showAlert('GoDaddy is not configured. Please check your API credentials.', 'error');
                }
            } catch (error) {
                showAlert(`Connection test failed: ${error.message}`, 'error');
            }
        }
        
        function saveSystemSettings() {
            const domain = document.getElementById('default-domain').value.trim();
            const env = document.getElementById('platform-env').value;
            
            // In a real implementation, this would save to backend
            localStorage.setItem('system_settings', JSON.stringify({domain, env}));
            showAlert('System settings saved!');
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved settings
            const savedGoDaddy = localStorage.getItem('godaddy_config');
            if (savedGoDaddy) {
                const config = JSON.parse(savedGoDaddy);
                document.getElementById('godaddy-key').value = config.key || '';
                document.getElementById('godaddy-env').value = config.env || 'production';
                // Don't show secret for security
            }
            
            const savedSystem = localStorage.getItem('system_settings');
            if (savedSystem) {
                const settings = JSON.parse(savedSystem);
                document.getElementById('default-domain').value = settings.domain || '';
                document.getElementById('platform-env').value = settings.env || 'development';
            }
            
            // Auto-check system status
            checkSystemStatus();
        });
        
        // Persona Management Functions
        async function loadPersonas() {
            const personasDiv = document.getElementById('personas-list');
            if (!personasDiv) {
                showAlert('Personas view not found', 'error');
                return;
            }
            
            personasDiv.innerHTML = '<div class="loading"></div>Loading personas...';
            
            try {
                const data = await apiRequest('/api/v1/personas/?skip=0&limit=50&active_only=false');
                
                if (!data || data.length === 0) {
                    personasDiv.innerHTML = '<p>No personas found. Create your first persona to get started!</p>';
                    return;
                }
                
                let personasHtml = '<div class="personas-grid">';
                data.forEach(persona => {
                    personasHtml += `
                        <div class="persona-card">
                            <div class="persona-header">
                                <h4>${persona.name}</h4>
                                <span class="status-badge ${persona.is_active ? 'active' : 'inactive'}">
                                    ${persona.is_active ? 'Active' : 'Inactive'}
                                </span>
                            </div>
                            <p class="persona-personality">${persona.personality.substring(0, 100)}${persona.personality.length > 100 ? '...' : ''}</p>
                            <div class="persona-stats">
                                <span>üìä Generated: ${persona.generation_count || 0}</span>
                                <span>‚≠ê Rating: ${persona.default_content_rating}</span>
                            </div>
                            <div class="persona-actions">
                                <button class="btn btn-sm" onclick="editPersona('${persona.id}')">Edit</button>
                                <button class="btn btn-sm btn-secondary" onclick="deletePersona('${persona.id}', '${persona.name}')">Delete</button>
                            </div>
                        </div>
                    `;
                });
                personasHtml += '</div>';
                
                personasDiv.innerHTML = personasHtml;
                showAlert('Personas loaded successfully!');
                
            } catch (error) {
                personasDiv.innerHTML = '<p class="error">Failed to load personas. Please try again.</p>';
                showAlert(`Failed to load personas: ${error.message}`, 'error');
            }
        }
        
        async function createPersona() {
            const name = prompt('Enter persona name:');
            if (!name) return;
            
            const personality = prompt('Enter personality description:');
            if (!personality) return;
            
            const appearance = prompt('Enter appearance description:');
            if (!appearance) return;
            
            try {
                const personaData = {
                    name: name,
                    personality: personality,
                    appearance: appearance,
                    content_themes: ['general', 'lifestyle'],
                    style_preferences: {
                        tone: 'friendly',
                        format: 'casual'
                    },
                    default_content_rating: 'sfw',
                    allowed_content_ratings: ['sfw'],
                    platform_restrictions: {}
                };
                
                const result = await apiRequest('/api/v1/personas/', {
                    method: 'POST',
                    body: JSON.stringify(personaData)
                });
                
                showAlert(`Persona "${name}" created successfully!`);
                loadPersonas(); // Reload the list
                
            } catch (error) {
                showAlert(`Failed to create persona: ${error.message}`, 'error');
            }
        }
        
        // Persona editing state
        let currentEditingPersonaId = null;
        let currentPersonaData = null;
        
        async function editPersona(personaId) {
            try {
                // Fetch the persona data
                const persona = await apiRequest(`/api/v1/personas/${personaId}`);
                currentEditingPersonaId = personaId;
                currentPersonaData = persona;
                
                // Populate the form
                document.getElementById('edit-name').value = persona.name || '';
                document.getElementById('edit-appearance').value = persona.appearance || '';
                document.getElementById('edit-personality').value = persona.personality || '';
                document.getElementById('edit-is-active').checked = persona.is_active !== false;
                
                // Content themes
                const themesContainer = document.getElementById('edit-themes-container');
                themesContainer.innerHTML = '';
                (persona.content_themes || []).forEach(theme => {
                    addThemeChip(theme);
                });
                
                // Style preferences
                const stylePrefs = persona.style_preferences || {};
                document.getElementById('edit-style-tone').value = stylePrefs.tone || 'friendly';
                document.getElementById('edit-style-format').value = stylePrefs.format || 'casual';
                
                // Content ratings
                document.getElementById('edit-default-rating').value = persona.default_content_rating || 'sfw';
                const allowedRatings = persona.allowed_content_ratings || ['sfw'];
                document.getElementById('edit-rating-sfw').checked = allowedRatings.includes('sfw');
                document.getElementById('edit-rating-moderate').checked = allowedRatings.includes('moderate');
                document.getElementById('edit-rating-nsfw').checked = allowedRatings.includes('nsfw');
                
                // Platform restrictions
                loadPlatformRestrictions(persona.platform_restrictions || {});
                
                // Base image fields
                document.getElementById('edit-base-appearance').value = persona.base_appearance_description || '';
                document.getElementById('edit-base-image-path').value = persona.base_image_path || '';
                document.getElementById('edit-base-image-status').value = persona.base_image_status || 'pending_upload';
                document.getElementById('edit-appearance-locked').checked = persona.appearance_locked || false;
                
                // Show the modal
                document.getElementById('editPersonaModal').classList.add('active');
                
            } catch (error) {
                showAlert(`Failed to load persona: ${error.message}`, 'error');
            }
        }
        
        function closeEditPersonaModal() {
            document.getElementById('editPersonaModal').classList.remove('active');
            currentEditingPersonaId = null;
            currentPersonaData = null;
        }
        
        function addTheme() {
            const input = document.getElementById('edit-theme-input');
            const theme = input.value.trim();
            
            if (!theme) {
                showAlert('Please enter a theme', 'error');
                return;
            }
            
            const container = document.getElementById('edit-themes-container');
            const existingThemes = container.querySelectorAll('.chip');
            
            if (existingThemes.length >= 10) {
                showAlert('Maximum 10 themes allowed', 'error');
                return;
            }
            
            // Check for duplicates
            const themeTexts = Array.from(existingThemes).map(chip => 
                chip.querySelector('.chip-text').textContent
            );
            if (themeTexts.includes(theme)) {
                showAlert('Theme already added', 'error');
                return;
            }
            
            addThemeChip(theme);
            input.value = '';
        }
        
        function addThemeChip(theme) {
            const container = document.getElementById('edit-themes-container');
            const chip = document.createElement('div');
            chip.className = 'chip';
            chip.innerHTML = `
                <span class="chip-text">${theme}</span>
                <span class="chip-remove" onclick="removeThemeChip(this)">√ó</span>
            `;
            container.appendChild(chip);
        }
        
        function removeThemeChip(element) {
            element.parentElement.remove();
        }
        
        function loadPlatformRestrictions(restrictions) {
            const container = document.getElementById('edit-platform-restrictions-container');
            container.innerHTML = '';
            
            // Add existing restrictions
            for (const [platform, restriction] of Object.entries(restrictions)) {
                addPlatformRestrictionRow(platform, restriction);
            }
            
            // Add one empty row if there are no restrictions
            if (Object.keys(restrictions).length === 0) {
                addPlatformRestrictionRow('', 'sfw_only');
            }
        }
        
        function addPlatformRestriction() {
            addPlatformRestrictionRow('', 'sfw_only');
        }
        
        function addPlatformRestrictionRow(platform = '', restriction = 'sfw_only') {
            const container = document.getElementById('edit-platform-restrictions-container');
            const row = document.createElement('div');
            row.className = 'platform-restriction-item';
            row.innerHTML = `
                <input type="text" class="form-control platform-name" placeholder="Platform (e.g., instagram)" value="${platform}">
                <select class="form-control platform-restriction">
                    <option value="sfw_only" ${restriction === 'sfw_only' ? 'selected' : ''}>SFW Only</option>
                    <option value="moderate_allowed" ${restriction === 'moderate_allowed' ? 'selected' : ''}>Moderate Allowed</option>
                    <option value="both" ${restriction === 'both' ? 'selected' : ''}>Both (SFW & NSFW)</option>
                    <option value="all" ${restriction === 'all' ? 'selected' : ''}>All</option>
                </select>
                <button type="button" class="btn btn-secondary btn-sm" onclick="removePlatformRestrictionRow(this)">Remove</button>
            `;
            container.appendChild(row);
        }
        
        function removePlatformRestrictionRow(button) {
            button.parentElement.remove();
        }
        
        async function savePersonaEdits() {
            try {
                // Validate required fields
                const name = document.getElementById('edit-name').value.trim();
                const appearance = document.getElementById('edit-appearance').value.trim();
                const personality = document.getElementById('edit-personality').value.trim();
                
                if (!name || name.length < 2) {
                    showAlert('Name must be at least 2 characters', 'error');
                    return;
                }
                
                if (!appearance || appearance.length < 10) {
                    showAlert('Appearance must be at least 10 characters', 'error');
                    return;
                }
                
                if (!personality || personality.length < 10) {
                    showAlert('Personality must be at least 10 characters', 'error');
                    return;
                }
                
                // Gather themes
                const themeChips = document.querySelectorAll('#edit-themes-container .chip-text');
                const content_themes = Array.from(themeChips).map(chip => chip.textContent);
                
                // Gather style preferences
                const style_preferences = {
                    tone: document.getElementById('edit-style-tone').value,
                    format: document.getElementById('edit-style-format').value
                };
                
                // Gather allowed ratings
                const allowed_content_ratings = [];
                if (document.getElementById('edit-rating-sfw').checked) allowed_content_ratings.push('sfw');
                if (document.getElementById('edit-rating-moderate').checked) allowed_content_ratings.push('moderate');
                if (document.getElementById('edit-rating-nsfw').checked) allowed_content_ratings.push('nsfw');
                
                if (allowed_content_ratings.length === 0) {
                    showAlert('At least one content rating must be allowed', 'error');
                    return;
                }
                
                // Gather platform restrictions
                const platform_restrictions = {};
                const restrictionRows = document.querySelectorAll('.platform-restriction-item');
                restrictionRows.forEach(row => {
                    const platformName = row.querySelector('.platform-name').value.trim();
                    const restriction = row.querySelector('.platform-restriction').value;
                    if (platformName) {
                        platform_restrictions[platformName] = restriction;
                    }
                });
                
                // Build update payload
                const updateData = {
                    name,
                    appearance,
                    personality,
                    content_themes,
                    style_preferences,
                    default_content_rating: document.getElementById('edit-default-rating').value,
                    allowed_content_ratings,
                    platform_restrictions,
                    is_active: document.getElementById('edit-is-active').checked,
                    base_appearance_description: document.getElementById('edit-base-appearance').value.trim() || null,
                    base_image_path: document.getElementById('edit-base-image-path').value.trim() || null,
                    base_image_status: document.getElementById('edit-base-image-status').value,
                    appearance_locked: document.getElementById('edit-appearance-locked').checked
                };
                
                // Send update request
                const result = await apiRequest(`/api/v1/personas/${currentEditingPersonaId}`, {
                    method: 'PUT',
                    body: JSON.stringify(updateData)
                });
                
                showAlert(`Persona "${name}" updated successfully!`);
                closeEditPersonaModal();
                loadPersonas(); // Reload the list
                
            } catch (error) {
                showAlert(`Failed to update persona: ${error.message}`, 'error');
            }
        }
        
        // Allow Enter key to add themes
        document.addEventListener('DOMContentLoaded', () => {
            const themeInput = document.getElementById('edit-theme-input');
            if (themeInput) {
                themeInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addTheme();
                    }
                });
            }
            
            // Close modal when clicking outside
            const modal = document.getElementById('editPersonaModal');
            if (modal) {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeEditPersonaModal();
                    }
                });
            }
        });
        
        async function deletePersona(personaId, personaName) {
            if (!confirm(`Are you sure you want to delete "${personaName}"?`)) {
                return;
            }
            
            try {
                await apiRequest(`/api/v1/personas/${personaId}`, {
                    method: 'DELETE'
                });
                
                showAlert(`Persona "${personaName}" deleted successfully!`);
                loadPersonas(); // Reload the list
                
            } catch (error) {
                showAlert(`Failed to delete persona: ${error.message}`, 'error');
            }
        }
        
        // Content Management Functions
        async function loadContent() {
            const contentDiv = document.getElementById('content-list');
            if (!contentDiv) {
                showAlert('Content view not found', 'error');
                return;
            }
            
            contentDiv.innerHTML = '<div class="loading"></div>Loading content...';
            
            try {
                const response = await apiRequest('/api/v1/content/?skip=0&limit=50');
                const data = response.content || response; // Handle both response formats
                
                if (!data || data.length === 0) {
                    contentDiv.innerHTML = '<p>No content generated yet. Generate your first content to get started!</p>';
                    return;
                }
                
                let contentHtml = '<div class="content-grid">';
                data.forEach(content => {
                    // Show appropriate text based on content type
                    let displayText = '';
                    if (content.text_content) {
                        displayText = content.text_content.substring(0, 100) + '...';
                    } else if (content.content_type === 'image' || content.content_type === 'video') {
                        displayText = `${content.content_type.charAt(0).toUpperCase() + content.content_type.slice(1)} content`;
                    } else {
                        displayText = 'View for details';
                    }
                    
                    contentHtml += `
                        <div class="content-card">
                            <div class="content-header">
                                <span class="content-type">${content.content_type}</span>
                                <span class="content-rating">${content.content_rating}</span>
                            </div>
                            ${content.image_url ? `<img src="${content.image_url}" alt="Generated content">` : ''}
                            <p class="content-text">${displayText}</p>
                            <div class="content-actions">
                                <button class="btn btn-sm" onclick="viewContent('${content.id}')">View</button>
                                <button class="btn btn-sm btn-secondary" onclick="deleteContent('${content.id}')">Delete</button>
                            </div>
                        </div>
                    `;
                });
                contentHtml += '</div>';
                
                contentDiv.innerHTML = contentHtml;
                showAlert('Content loaded successfully!');
                
            } catch (error) {
                contentDiv.innerHTML = '<p class="error">Failed to load content. Please try again.</p>';
                showAlert(`Failed to load content: ${error.message}`, 'error');
            }
        }
        
        async function generateContent() {
            try {
                const personas = await apiRequest('/api/v1/personas/?skip=0&limit=100');
                
                if (!personas || personas.length === 0) {
                    showAlert('Please create a persona first before generating content!', 'error');
                    return;
                }
                
                const personaId = personas[0].id; // Use first persona
                const userPrompt = prompt('Enter a prompt for content generation (or leave empty for auto):') || 'Generate engaging social media content';
                
                const requestData = {
                    persona_id: personaId,
                    content_type: 'image',
                    prompt: userPrompt
                };
                
                const result = await apiRequest('/api/v1/content/generate', {
                    method: 'POST',
                    body: JSON.stringify(requestData)
                });
                
                showAlert('Content generation started! This may take a few moments...');
                
                // Refresh content list after a delay
                setTimeout(() => {
                    loadContent();
                }, 3000);
                
            } catch (error) {
                showAlert(`Failed to generate content: ${error.message}`, 'error');
            }
        }
        
        async function viewContent(contentId) {
            try {
                // Fetch content details
                const content = await apiRequest(`/api/v1/content/${contentId}`);
                
                // Populate modal with content details
                document.getElementById('view-content-type').textContent = content.content_type.toUpperCase();
                document.getElementById('view-content-rating').textContent = content.content_rating.toUpperCase();
                document.getElementById('view-content-title').textContent = content.title || 'Untitled';
                document.getElementById('view-content-description').textContent = content.description || 'No description';
                document.getElementById('view-content-created').textContent = new Date(content.created_at).toLocaleString();
                document.getElementById('view-content-status').textContent = content.moderation_status.toUpperCase();
                
                // Show quality score if available
                const qualityElement = document.getElementById('view-content-quality');
                if (content.quality_score) {
                    qualityElement.textContent = `${content.quality_score}/100`;
                } else {
                    qualityElement.textContent = 'N/A';
                }
                
                // Handle content preview based on type
                const previewContainer = document.getElementById('view-content-preview');
                previewContainer.innerHTML = '';
                
                if (content.content_type === 'image') {
                    // For images, try to show the actual image or placeholder
                    if (content.file_path && !content.file_path.endsWith('.txt')) {
                        const img = document.createElement('img');
                        img.src = content.file_path;
                        img.alt = content.title;
                        img.style.maxWidth = '100%';
                        img.style.borderRadius = '8px';
                        img.onerror = function() {
                            // If image fails to load, show placeholder
                            previewContainer.innerHTML = `
                                <div style="padding: 40px; text-align: center; background: #f5f5f5; border-radius: 8px;">
                                    <span style="font-size: 48px;">üñºÔ∏è</span>
                                    <p style="margin-top: 12px; color: #666;">Image preview not available</p>
                                    <small style="color: #999;">${content.file_path || 'No file path'}</small>
                                </div>
                            `;
                        };
                        previewContainer.appendChild(img);
                    } else {
                        previewContainer.innerHTML = `
                            <div style="padding: 40px; text-align: center; background: #f5f5f5; border-radius: 8px;">
                                <span style="font-size: 48px;">üñºÔ∏è</span>
                                <p style="margin-top: 12px; color: #666;">No image file available</p>
                            </div>
                        `;
                    }
                } else if (content.content_type === 'text') {
                    // For text content, show the text or a preview
                    const textContent = content.generation_params?.full_text || 
                                      content.generation_params?.text_preview || 
                                      'Text content not available';
                    previewContainer.innerHTML = `
                        <div style="padding: 20px; background: #f9f9f9; border-radius: 8px; white-space: pre-wrap; font-family: 'Georgia', serif; line-height: 1.6;">
                            ${textContent}
                        </div>
                    `;
                } else if (content.content_type === 'video') {
                    previewContainer.innerHTML = `
                        <div style="padding: 40px; text-align: center; background: #f5f5f5; border-radius: 8px;">
                            <span style="font-size: 48px;">üé¨</span>
                            <p style="margin-top: 12px; color: #666;">Video content</p>
                            <small style="color: #999;">Duration: ${content.generation_params?.duration || 'N/A'}s</small>
                        </div>
                    `;
                } else if (content.content_type === 'audio' || content.content_type === 'voice') {
                    previewContainer.innerHTML = `
                        <div style="padding: 40px; text-align: center; background: #f5f5f5; border-radius: 8px;">
                            <span style="font-size: 48px;">üéµ</span>
                            <p style="margin-top: 12px; color: #666;">${content.content_type === 'voice' ? 'Voice' : 'Audio'} content</p>
                            <small style="color: #999;">Duration: ${content.generation_params?.duration || 'N/A'}s</small>
                        </div>
                    `;
                } else {
                    previewContainer.innerHTML = `
                        <div style="padding: 40px; text-align: center; background: #f5f5f5; border-radius: 8px;">
                            <span style="font-size: 48px;">üìÑ</span>
                            <p style="margin-top: 12px; color: #666;">Content preview not available</p>
                        </div>
                    `;
                }
                
                // Show generation parameters
                const paramsElement = document.getElementById('view-content-params');
                if (content.generation_params && Object.keys(content.generation_params).length > 0) {
                    paramsElement.innerHTML = `<pre style="background: #f5f5f5; padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 0.85rem;">${JSON.stringify(content.generation_params, null, 2)}</pre>`;
                } else {
                    paramsElement.innerHTML = '<p style="color: #999;">No generation parameters available</p>';
                }
                
                // Show platform adaptations
                const adaptationsElement = document.getElementById('view-content-adaptations');
                if (content.platform_adaptations && Object.keys(content.platform_adaptations).length > 0) {
                    adaptationsElement.innerHTML = `<pre style="background: #f5f5f5; padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 0.85rem;">${JSON.stringify(content.platform_adaptations, null, 2)}</pre>`;
                } else {
                    adaptationsElement.innerHTML = '<p style="color: #999;">No platform adaptations</p>';
                }
                
                // Show the modal
                document.getElementById('viewContentModal').classList.add('active');
                
            } catch (error) {
                showAlert(`Failed to load content details: ${error.message}`, 'error');
            }
        }
        
        function closeViewContentModal() {
            document.getElementById('viewContentModal').classList.remove('active');
        }
        
        async function deleteContent(contentId) {
            if (!confirm('Are you sure you want to delete this content?')) {
                return;
            }
            
            try {
                await apiRequest(`/api/v1/content/${contentId}`, {
                    method: 'DELETE'
                });
                
                showAlert('Content deleted successfully!');
                loadContent(); // Reload the list
                
            } catch (error) {
                showAlert(`Failed to delete content: ${error.message}`, 'error');
            }
        }
        
        // DNS Record Management Functions
        async function editRecord(name, type) {
            const domain = document.getElementById('domain-input').value.trim();
            if (!domain) {
                showAlert('Please load a domain first', 'error');
                return;
            }
            
            const newValue = prompt(`Enter new value for ${name} (${type}):`);
            if (!newValue) return;
            
            try {
                await apiRequest(`/api/v1/dns/domain/${domain}/records/${type}/${name}`, {
                    method: 'PUT',
                    body: JSON.stringify({
                        data: newValue,
                        ttl: 3600
                    })
                });
                
                showAlert(`DNS record updated successfully!`);
                loadDomainInfo(); // Reload domain info
                
            } catch (error) {
                showAlert(`Failed to update DNS record: ${error.message}`, 'error');
            }
        }
        
        async function deleteRecord(name, type) {
            const domain = document.getElementById('domain-input').value.trim();
            if (!domain) {
                showAlert('Please load a domain first', 'error');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete the ${type} record for ${name}?`)) {
                return;
            }
            
            try {
                await apiRequest(`/api/v1/dns/domain/${domain}/records/${type}/${name}`, {
                    method: 'DELETE'
                });
                
                showAlert('DNS record deleted successfully!');
                loadDomainInfo(); // Reload domain info
                
            } catch (error) {
                showAlert(`Failed to delete DNS record: ${error.message}`, 'error');
            }
        }
        
        // Gator Chat Functions
        let chatInitialized = false;
        
        async function initializeGatorChat() {
            if (chatInitialized) return;
            
            try {
                // Load quick help topics
                const response = await apiRequest('/api/v1/gator-agent/quick-help');
                const quickHelpSection = document.getElementById('quick-help-section');
                
                quickHelpSection.innerHTML = response.map(topic => 
                    `<button class="quick-help-btn" onclick="sendQuickMessage('${topic.message}')">${topic.topic}</button>`
                ).join('');
                
                chatInitialized = true;
            } catch (error) {
                console.error('Failed to initialize Gator chat:', error);
            }
        }
        
        function sendQuickMessage(message) {
            const chatInput = document.getElementById('chat-input');
            chatInput.value = message;
            sendChatMessage();
        }
        
        async function sendChatMessage() {
            const chatInput = document.getElementById('chat-input');
            const chatMessages = document.getElementById('chat-messages');
            const chatTyping = document.getElementById('chat-typing');
            const sendBtn = document.getElementById('chat-send-btn');
            
            const message = chatInput.value.trim();
            if (!message) return;
            
            // Disable input while processing
            chatInput.disabled = true;
            sendBtn.disabled = true;
            
            // Add user message to chat
            const userMessageHtml = `
                <div class="chat-message user">
                    <div class="message-author">You</div>
                    <div class="message-content">${escapeHtml(message)}</div>
                </div>
            `;
            chatMessages.insertAdjacentHTML('beforeend', userMessageHtml);
            
            // Clear input
            chatInput.value = '';
            
            // Show typing indicator
            chatTyping.style.display = 'flex';
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            try {
                // Send message to Gator
                const response = await apiRequest('/api/v1/gator-agent/chat', {
                    method: 'POST',
                    body: JSON.stringify({
                        message: message,
                        context: {
                            current_tab: getCurrentTab(),
                            timestamp: new Date().toISOString()
                        }
                    })
                });
                
                // Hide typing indicator
                chatTyping.style.display = 'none';
                
                // Add Gator's response
                const gatorMessageHtml = `
                    <div class="chat-message gator">
                        <div class="message-author">Gator</div>
                        <div class="message-content">${escapeHtml(response.response)}</div>
                    </div>
                `;
                chatMessages.insertAdjacentHTML('beforeend', gatorMessageHtml);
                
            } catch (error) {
                // Hide typing indicator
                chatTyping.style.display = 'none';
                
                // Show error message
                const errorMessageHtml = `
                    <div class="chat-message gator">
                        <div class="message-author">Gator</div>
                        <div class="message-content">Hold up - something went wrong on my end. ${error.message || 'Try again in a minute.'}</div>
                    </div>
                `;
                chatMessages.insertAdjacentHTML('beforeend', errorMessageHtml);
            }
            
            // Re-enable input
            chatInput.disabled = false;
            sendBtn.disabled = false;
            chatInput.focus();
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function getCurrentTab() {
            const activeTab = document.querySelector('.tab-content.active');
            return activeTab ? activeTab.id : 'dashboard';
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Enhanced tab management to handle chat initialization
        const originalShowTab = showTab;
        showTab = function(tabName) {
            originalShowTab(tabName);
            
            // Initialize chat when Gator tab is shown
            if (tabName === 'gator-help') {
                initializeGatorChat();
            }
        };
        
        // Chat form submission
        document.addEventListener('DOMContentLoaded', () => {
            const chatForm = document.getElementById('chat-form');
            if (chatForm) {
                chatForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    sendChatMessage();
                });
            }
            
            // Enter key handler for chat input
            const chatInput = document.getElementById('chat-input');
            if (chatInput) {
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendChatMessage();
                    }
                });
            }
            
            // Load setup status on settings tab load
            if (document.getElementById('settings')) {
                loadSetupStatus();
            }
        });
        
        // Setup Management Functions
        async function loadSetupStatus() {
            const statusDisplay = document.getElementById('setup-status-display');
            if (!statusDisplay) return;
            
            statusDisplay.innerHTML = '<p style="margin: 0;">Loading configuration status...</p>';
            
            try {
                const response = await apiRequest('/api/v1/setup/status');
                
                let statusHtml = '<div style="line-height: 1.6;">';
                statusHtml += `<p><strong>Environment File:</strong> ${response.env_file_exists ? '‚úÖ Found' : '‚ùå Not Found'}</p>`;
                statusHtml += `<p><strong>Location:</strong> ${response.env_file_path}</p>`;
                
                if (response.configured_sections) {
                    statusHtml += '<p><strong>Configured Sections:</strong></p><ul style="margin: 0.5rem 0; padding-left: 1.5rem;">';
                    statusHtml += `<li>Database: ${response.configured_sections.database ? '‚úÖ' : '‚ùå'}</li>`;
                    statusHtml += `<li>AI Models: ${response.configured_sections.ai_models ? '‚úÖ' : '‚ùå'}</li>`;
                    statusHtml += `<li>Social Media: ${response.configured_sections.social_media ? '‚úÖ' : '‚ùå'}</li>`;
                    statusHtml += `<li>DNS Management: ${response.configured_sections.dns ? '‚úÖ' : '‚ùå'}</li>`;
                    statusHtml += `<li>Security: ${response.configured_sections.security ? '‚úÖ' : '‚ùå'}</li>`;
                    statusHtml += '</ul>';
                }
                
                statusHtml += '</div>';
                statusDisplay.innerHTML = statusHtml;
                
                // Load current values into form
                if (response.current_config) {
                    loadConfigIntoForm(response.current_config);
                }
                
            } catch (error) {
                statusDisplay.innerHTML = `<p style="margin: 0; color: #dc2626;">Error loading status: ${error.message}</p>`;
            }
        }
        
        function loadConfigIntoForm(config) {
            // Database
            if (config.DATABASE_URL && !config.DATABASE_URL.includes('sqlite')) {
                document.getElementById('setup-database-url').value = config.DATABASE_URL;
            }
            if (config.REDIS_URL) {
                document.getElementById('setup-redis-url').value = config.REDIS_URL;
            }
            
            // Security - don't load secrets, just show they're configured
            if (config.SECRET_KEY === '***CONFIGURED***') {
                document.getElementById('setup-secret-key').placeholder = '***CONFIGURED*** (leave blank to keep current)';
            }
            if (config.JWT_SECRET === '***CONFIGURED***') {
                document.getElementById('setup-jwt-secret').placeholder = '***CONFIGURED*** (leave blank to keep current)';
            }
            
            // AI Models
            if (config.OPENAI_API_KEY === '***CONFIGURED***') {
                document.getElementById('setup-openai-key').placeholder = '***CONFIGURED*** (leave blank to keep current)';
            }
            if (config.ANTHROPIC_API_KEY === '***CONFIGURED***') {
                document.getElementById('setup-anthropic-key').placeholder = '***CONFIGURED*** (leave blank to keep current)';
            }
            if (config.HUGGING_FACE_TOKEN === '***CONFIGURED***') {
                document.getElementById('setup-huggingface-token').placeholder = '***CONFIGURED*** (leave blank to keep current)';
            }
            
            // Social Media
            if (config.FACEBOOK_API_KEY === '***CONFIGURED***') {
                document.getElementById('setup-facebook-key').placeholder = '***CONFIGURED*** (leave blank to keep current)';
            }
            if (config.INSTAGRAM_API_KEY === '***CONFIGURED***') {
                document.getElementById('setup-instagram-key').placeholder = '***CONFIGURED*** (leave blank to keep current)';
            }
            if (config.TWITTER_API_KEY === '***CONFIGURED***') {
                document.getElementById('setup-twitter-key').placeholder = '***CONFIGURED*** (leave blank to keep current)';
            }
            
            // DNS
            if (config.GODADDY_API_KEY === '***CONFIGURED***') {
                document.getElementById('setup-godaddy-key').placeholder = '***CONFIGURED*** (leave blank to keep current)';
            }
            if (config.GODADDY_API_SECRET === '***CONFIGURED***') {
                document.getElementById('setup-godaddy-secret').placeholder = '***CONFIGURED*** (leave blank to keep current)';
            }
            if (config.DEFAULT_DOMAIN) {
                document.getElementById('setup-default-domain').value = config.DEFAULT_DOMAIN;
            }
            
            // Application Settings
            if (config.ENVIRONMENT) {
                document.getElementById('setup-environment').value = config.ENVIRONMENT;
            }
            if (config.DEBUG) {
                document.getElementById('setup-debug').value = config.DEBUG;
            }
            if (config.LOG_LEVEL) {
                document.getElementById('setup-log-level').value = config.LOG_LEVEL;
            }
        }
        
        async function saveSetupConfiguration() {
            const resultDiv = document.getElementById('setup-result');
            resultDiv.innerHTML = '<p style="color: #3b82f6;">Saving configuration...</p>';
            
            // Gather form values - only include non-empty values
            const config = {};
            
            // Database
            const dbUrl = document.getElementById('setup-database-url').value.trim();
            if (dbUrl) config.database_url = dbUrl;
            
            const redisUrl = document.getElementById('setup-redis-url').value.trim();
            if (redisUrl) config.redis_url = redisUrl;
            
            // Security
            const secretKey = document.getElementById('setup-secret-key').value.trim();
            if (secretKey) config.secret_key = secretKey;
            
            const jwtSecret = document.getElementById('setup-jwt-secret').value.trim();
            if (jwtSecret) config.jwt_secret = jwtSecret;
            
            // AI Models
            const openaiKey = document.getElementById('setup-openai-key').value.trim();
            if (openaiKey) config.openai_api_key = openaiKey;
            
            const anthropicKey = document.getElementById('setup-anthropic-key').value.trim();
            if (anthropicKey) config.anthropic_api_key = anthropicKey;
            
            const hfToken = document.getElementById('setup-huggingface-token').value.trim();
            if (hfToken) config.hugging_face_token = hfToken;
            
            // Social Media
            const fbKey = document.getElementById('setup-facebook-key').value.trim();
            if (fbKey) config.facebook_api_key = fbKey;
            
            const igKey = document.getElementById('setup-instagram-key').value.trim();
            if (igKey) config.instagram_api_key = igKey;
            
            const twitterKey = document.getElementById('setup-twitter-key').value.trim();
            if (twitterKey) config.twitter_api_key = twitterKey;
            
            // DNS
            const godaddyKey = document.getElementById('setup-godaddy-key').value.trim();
            if (godaddyKey) config.godaddy_api_key = godaddyKey;
            
            const godaddySecret = document.getElementById('setup-godaddy-secret').value.trim();
            if (godaddySecret) config.godaddy_api_secret = godaddySecret;
            
            const defaultDomain = document.getElementById('setup-default-domain').value.trim();
            if (defaultDomain) config.default_domain = defaultDomain;
            
            // Application Settings
            const environment = document.getElementById('setup-environment').value;
            if (environment) config.environment = environment;
            
            const debug = document.getElementById('setup-debug').value;
            if (debug) config.debug = debug === 'true';
            
            const logLevel = document.getElementById('setup-log-level').value;
            if (logLevel) config.log_level = logLevel;
            
            if (Object.keys(config).length === 0) {
                resultDiv.innerHTML = '<p style="color: #dc2626;">No configuration values to save. Please fill in at least one field.</p>';
                return;
            }
            
            try {
                const response = await apiRequest('/api/v1/setup/config', {
                    method: 'POST',
                    body: JSON.stringify(config)
                });
                
                if (response.success) {
                    let message = `<div style="padding: 1rem; background: #d1fae5; border: 1px solid #22c55e; border-radius: 4px; color: #166534;">
                        <strong>‚úÖ Configuration Saved Successfully!</strong><br>
                        ${response.message}
                    </div>`;
                    
                    if (response.validation.warnings && response.validation.warnings.length > 0) {
                        message += `<div style="margin-top: 0.5rem; padding: 0.5rem; background: #fef3c7; border: 1px solid #f59e0b; border-radius: 4px; color: #92400e;">
                            <strong>‚ö†Ô∏è Warnings:</strong><ul style="margin: 0.25rem 0; padding-left: 1.5rem;">`;
                        response.validation.warnings.forEach(warning => {
                            message += `<li>${warning}</li>`;
                        });
                        message += `</ul></div>`;
                    }
                    
                    if (response.restart_required) {
                        message += `<p style="margin-top: 0.5rem; font-weight: bold; color: #dc2626;">
                            ‚ö†Ô∏è Application restart required for changes to take effect.
                        </p>`;
                    }
                    
                    resultDiv.innerHTML = message;
                    
                    // Refresh status after save
                    setTimeout(() => loadSetupStatus(), 1000);
                    
                } else {
                    resultDiv.innerHTML = `<div style="padding: 1rem; background: #fee2e2; border: 1px solid #dc2626; border-radius: 4px; color: #991b1b;">
                        <strong>‚ùå Configuration Save Failed</strong><br>
                        ${response.message}
                    </div>`;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div style="padding: 1rem; background: #fee2e2; border: 1px solid #dc2626; border-radius: 4px; color: #991b1b;">
                    <strong>‚ùå Error Saving Configuration</strong><br>
                    ${error.message}
                </div>`;
            }
        }
        
        function resetSetupForm() {
            // Clear all input fields
            document.querySelectorAll('.setup-sections input').forEach(input => {
                input.value = '';
            });
            
            // Reset dropdowns to default
            document.getElementById('setup-environment').value = 'development';
            document.getElementById('setup-debug').value = 'true';
            document.getElementById('setup-log-level').value = 'DEBUG';
            
            // Clear result
            document.getElementById('setup-result').innerHTML = '';
            
            // Reload status to restore placeholders
            loadSetupStatus();
        }
        
        // RSS Feeds Functions
        async function loadRSSFeeds() {
            const feedsList = document.getElementById('feeds-list');
            feedsList.innerHTML = '<div class="loading"></div>Loading RSS feeds...';
            
            try {
                const response = await apiRequest('/api/v1/feeds/');
                feedsList.innerHTML = '<h3>RSS Feeds</h3>';
                if (response.length === 0) {
                    feedsList.innerHTML += '<p>No RSS feeds configured yet.</p>';
                } else {
                    response.forEach(feed => {
                        feedsList.innerHTML += `
                            <div class="dns-record">
                                <div class="record-info">
                                    <div class="record-name">${feed.name || feed.url}</div>
                                    <div class="record-details">URL: ${feed.url}</div>
                                </div>
                            </div>
                        `;
                    });
                }
            } catch (error) {
                feedsList.innerHTML = `<div class="alert alert-error">Error loading feeds: ${error.message}</div>`;
            }
        }
        
        async function addRSSFeed() {
            const url = prompt('Enter RSS feed URL:');
            if (!url) return;
            
            const name = prompt('Enter feed name (optional):');
            
            try {
                await apiRequest('/api/v1/feeds/', {
                    method: 'POST',
                    body: JSON.stringify({ url, name: name || url })
                });
                showAlert('RSS feed added successfully!');
                loadRSSFeeds();
            } catch (error) {
                showAlert(`Error adding feed: ${error.message}`, 'error');
            }
        }
        
        async function fetchAllFeeds() {
            try {
                const response = await apiRequest('/api/v1/feeds/fetch', { method: 'POST' });
                showAlert(`Fetched ${response.items_count || 0} new items from feeds!`);
                loadRSSFeeds();
            } catch (error) {
                showAlert(`Error fetching feeds: ${error.message}`, 'error');
            }
        }
        
        async function loadTrendingTopics() {
            const trendingList = document.getElementById('trending-list');
            trendingList.innerHTML = '<div class="loading"></div>Loading trending topics...';
            
            try {
                const response = await apiRequest('/api/v1/feeds/trending');
                trendingList.innerHTML = '<h3>Trending Topics</h3>';
                if (response.length === 0) {
                    trendingList.innerHTML += '<p>No trending topics found.</p>';
                } else {
                    response.forEach(topic => {
                        trendingList.innerHTML += `
                            <div class="dns-record">
                                <div class="record-info">
                                    <div class="record-name">${topic.title || topic.topic}</div>
                                    <div class="record-details">Mentions: ${topic.count || 0}</div>
                                </div>
                            </div>
                        `;
                    });
                }
            } catch (error) {
                trendingList.innerHTML = `<div class="alert alert-error">Error loading trending topics: ${error.message}</div>`;
            }
        }
        
        // Social Media Functions
        async function loadSocialAccounts() {
            const accountsList = document.getElementById('social-accounts-list');
            accountsList.innerHTML = '<div class="loading"></div>Loading social media platforms...';
            
            try {
                const response = await apiRequest('/api/v1/social/platforms');
                
                if (!response || !response.supported_platforms) {
                    accountsList.innerHTML = '<p>No platform information available.</p>';
                    return;
                }
                
                const platforms = response.supported_platforms;
                let platformsHtml = '<div style="margin-top: 15px;"><h3>Supported Social Media Platforms</h3>';
                platformsHtml += `<p style="color: #666; margin-bottom: 15px;">Configure these platforms in Settings to enable publishing. Total: ${response.total_platforms}</p>`;
                
                Object.keys(platforms).forEach(key => {
                    const platform = platforms[key];
                    const contentTypes = platform.supported_content.join(', ');
                    platformsHtml += `
                        <div style="padding: 15px; margin-bottom: 10px; border: 1px solid #e0e0e0; border-radius: 8px; background: #f9f9f9;">
                            <h4 style="margin: 0 0 8px 0; color: #667eea;">${platform.name}</h4>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 0.9rem;">
                                <div><strong>Content Types:</strong> ${contentTypes}</div>
                                <div><strong>Max Caption:</strong> ${platform.max_caption_length} chars</div>
                                <div><strong>Scheduling:</strong> ${platform.supports_scheduling ? '‚úÖ Supported' : '‚ùå Not supported'}</div>
                            </div>
                        </div>
                    `;
                });
                platformsHtml += '</div>';
                accountsList.innerHTML = platformsHtml;
                
            } catch (error) {
                accountsList.innerHTML = `<div class="alert alert-error">Error loading platforms: ${error.message}</div>`;
            }
        }
        
        async function addSocialAccount() {
            showAlert('Use the Settings tab to configure social media API credentials first.', 'error');
        }
        
        async function publishToSocial() {
            showAlert('Publishing to social media - feature available via API endpoints.', 'error');
        }
        
        async function scheduleToSocial() {
            showAlert('Scheduling to social media - feature available via API endpoints.', 'error');
        }
        
        // Direct Messaging Functions
        async function getNextConversation() {
            const queueDiv = document.getElementById('conversation-queue');
            queueDiv.innerHTML = '<div class="loading"></div>Getting next conversation...';
            
            try {
                const response = await apiRequest('/api/v1/dm/queue/next');
                if (!response || !response.id) {
                    queueDiv.innerHTML = '<p>No pending conversations in queue.</p>';
                } else {
                    queueDiv.innerHTML = `
                        <h3>Next Conversation</h3>
                        <div class="dns-record">
                            <div class="record-info">
                                <div class="record-name">Conversation ID: ${response.id}</div>
                                <div class="record-details">Status: ${response.status}</div>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                queueDiv.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
            }
        }
        
        async function viewQueueStatus() {
            const queueDiv = document.getElementById('conversation-queue');
            queueDiv.innerHTML = '<div class="loading"></div>Loading queue status...';
            
            try {
                const response = await apiRequest('/api/v1/dm/queue/status');
                queueDiv.innerHTML = `
                    <h3>Queue Status</h3>
                    <p>Pending conversations: ${response.pending || 0}</p>
                `;
            } catch (error) {
                queueDiv.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
            }
        }
        
        async function createPPVOffer() {
            // For now, show a message that this requires a conversation context
            showAlert('PPV Offers are created in the context of a conversation. Use the API endpoint /api/v1/dm/ppv-offers with conversation details.', 'error');
        }
        
        async function loadPPVOffers() {
            const offersList = document.getElementById('ppv-offers-list');
            offersList.innerHTML = '<div class="loading"></div>Loading PPV offers...';
            
            try {
                const response = await apiRequest('/api/v1/dm/ppv-offers?limit=50');
                
                if (!response || response.length === 0) {
                    offersList.innerHTML = '<p>No PPV offers found. Offers will appear here once created in conversations.</p>';
                    return;
                }
                
                let offersHtml = '<div style="margin-top: 15px;"><h3>PPV Offers</h3>';
                response.forEach(offer => {
                    const statusColor = offer.status === 'accepted' ? '#4caf50' : 
                                      offer.status === 'pending' ? '#ff9800' : '#999';
                    offersHtml += `
                        <div style="padding: 15px; margin-bottom: 10px; border: 1px solid #e0e0e0; border-radius: 8px; background: #f9f9f9;">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div style="flex: 1;">
                                    <h4 style="margin: 0 0 5px 0; color: #333;">${offer.title}</h4>
                                    <p style="margin: 0 0 8px 0; color: #666; font-size: 0.9rem;">${offer.description}</p>
                                    <div style="display: flex; gap: 15px; font-size: 0.85rem; color: #888;">
                                        <span><strong>Type:</strong> ${offer.offer_type}</span>
                                        <span><strong>Price:</strong> $${offer.price} ${offer.currency}</span>
                                        <span><strong>Status:</strong> <span style="color: ${statusColor}; font-weight: 600;">${offer.status}</span></span>
                                    </div>
                                </div>
                            </div>
                            ${offer.preview_url ? `<img src="${offer.preview_url}" style="max-width: 200px; margin-top: 10px; border-radius: 6px;" alt="Preview">` : ''}
                        </div>
                    `;
                });
                offersHtml += '</div>';
                offersList.innerHTML = offersHtml;
                
            } catch (error) {
                offersList.innerHTML = `<p class="error">Failed to load PPV offers: ${error.message}</p>`;
                showAlert(`Failed to load PPV offers: ${error.message}`, 'error');
            }
        }
        
        // Users Functions
        async function loadUsers() {
            const usersList = document.getElementById('users-list');
            usersList.innerHTML = '<div class="loading"></div>Loading users...';
            
            try {
                const response = await apiRequest('/api/v1/users/');
                usersList.innerHTML = '<h3>Users</h3>';
                if (response.length === 0) {
                    usersList.innerHTML += '<p>No users found.</p>';
                } else {
                    response.forEach(user => {
                        usersList.innerHTML += `
                            <div class="dns-record">
                                <div class="record-info">
                                    <div class="record-name">${user.username || user.email}</div>
                                    <div class="record-details">ID: ${user.id}</div>
                                </div>
                            </div>
                        `;
                    });
                }
            } catch (error) {
                usersList.innerHTML = `<div class="alert alert-error">Error loading users: ${error.message}</div>`;
            }
        }
        
        async function createUser() {
            showAlert('User creation - use API endpoints to create users.', 'error');
        }
        
        // Analytics Functions
        async function loadPlatformMetrics() {
            const metricsDiv = document.getElementById('platform-metrics');
            metricsDiv.innerHTML = '<div class="loading"></div>Loading metrics...';
            
            try {
                const response = await apiRequest('/api/v1/analytics/metrics');
                metricsDiv.innerHTML = `
                    <h3>Platform Metrics</h3>
                    <pre>${JSON.stringify(response, null, 2)}</pre>
                `;
            } catch (error) {
                metricsDiv.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
            }
        }
        
        async function loadCreatorDashboard() {
            const dashboardDiv = document.getElementById('creator-dashboard');
            dashboardDiv.innerHTML = '<div class="loading"></div>Loading dashboard...';
            
            try {
                const response = await apiRequest('/api/v1/creator/dashboard');
                dashboardDiv.innerHTML = `
                    <h3>Creator Dashboard</h3>
                    <pre>${JSON.stringify(response, null, 2)}</pre>
                `;
            } catch (error) {
                dashboardDiv.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
            }
        }
        
        async function loadPersonaAnalytics() {
            const personaSelect = document.getElementById('analytics-persona-select');
            const personaId = personaSelect.value;
            
            if (!personaId || personaId === 'Select a persona...') {
                showAlert('Please select a persona first.', 'error');
                return;
            }
            
            const analyticsDiv = document.getElementById('persona-analytics');
            analyticsDiv.innerHTML = '<div class="loading"></div>Loading persona analytics...';
            
            try {
                const response = await apiRequest(`/api/v1/creator/personas/analytics/${personaId}`);
                analyticsDiv.innerHTML = `
                    <h3>Persona Analytics</h3>
                    <pre>${JSON.stringify(response, null, 2)}</pre>
                `;
            } catch (error) {
                analyticsDiv.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
            }
        }
        
        // Database Management Functions
        async function loadDatabaseInfo() {
            try {
                const response = await apiRequest('/api/v1/admin/database/info');
                const contentDiv = document.getElementById('database-info-content');
                
                if (response.success) {
                    contentDiv.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                            <div style="padding: 15px; background: #f8f9fa; border-radius: 5px;">
                                <div style="font-weight: 600; color: #667eea; margin-bottom: 5px;">Database Type</div>
                                <div style="font-size: 1.2rem;">${response.database_type}</div>
                            </div>
                            <div style="padding: 15px; background: #f8f9fa; border-radius: 5px;">
                                <div style="font-weight: 600; color: #667eea; margin-bottom: 5px;">Status</div>
                                <div style="font-size: 1.2rem;">‚úÖ ${response.connection_status}</div>
                            </div>
                            <div style="padding: 15px; background: #f8f9fa; border-radius: 5px;">
                                <div style="font-weight: 600; color: #667eea; margin-bottom: 5px;">Tables</div>
                                <div style="font-size: 1.2rem;">${response.table_count} tables</div>
                            </div>
                            ${response.size_mb ? `
                            <div style="padding: 15px; background: #f8f9fa; border-radius: 5px;">
                                <div style="font-weight: 600; color: #667eea; margin-bottom: 5px;">Database Size</div>
                                <div style="font-size: 1.2rem;">${response.size_mb} MB</div>
                            </div>
                            ` : ''}
                        </div>
                        <div style="margin-top: 15px;">
                            <details>
                                <summary style="cursor: pointer; font-weight: 600; color: #333;">
                                    üìã View Tables (${response.table_count})
                                </summary>
                                <ul style="margin-top: 10px; padding-left: 20px;">
                                    ${response.tables.map(table => `<li>${table}</li>`).join('')}
                                </ul>
                            </details>
                        </div>
                    `;
                } else {
                    contentDiv.innerHTML = `<div class="alert alert-error">Error: ${response.message || 'Failed to load database info'}</div>`;
                }
            } catch (error) {
                document.getElementById('database-info-content').innerHTML = 
                    `<div class="alert alert-error">Error: ${error.message}</div>`;
            }
        }
        
        async function checkSchemaStatus() {
            const contentDiv = document.getElementById('schema-status-content');
            contentDiv.innerHTML = '<div class="loading"></div>Checking schema status...';
            
            try {
                const response = await apiRequest('/api/v1/admin/database/schema/status');
                
                if (response.success) {
                    const statusIcon = response.in_sync ? '‚úÖ' : '‚ö†Ô∏è';
                    const statusColor = response.in_sync ? '#28a745' : '#ffc107';
                    
                    let html = `
                        <div style="padding: 15px; background: #f8f9fa; border-radius: 5px; margin-top: 15px;">
                            <div style="font-size: 1.2rem; font-weight: 600; color: ${statusColor}; margin-bottom: 10px;">
                                ${statusIcon} ${response.message}
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 10px;">
                                <div>
                                    <span style="font-weight: 600;">Database Tables:</span> ${response.total_tables_in_db}
                                </div>
                                <div>
                                    <span style="font-weight: 600;">Model Tables:</span> ${response.total_tables_in_models}
                                </div>
                            </div>
                    `;
                    
                    if (response.missing_tables && response.missing_tables.length > 0) {
                        html += `
                            <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 5px;">
                                <strong style="color: #856404;">Missing Tables (${response.missing_tables.length}):</strong>
                                <ul style="margin: 5px 0 0 20px; color: #856404;">
                                    ${response.missing_tables.map(table => `<li>${table}</li>`).join('')}
                                </ul>
                                <p style="margin-top: 10px; color: #856404;">
                                    Click "Sync Schema Now" to create these tables.
                                </p>
                            </div>
                        `;
                    }
                    
                    if (response.extra_tables && response.extra_tables.length > 0) {
                        html += `
                            <div style="margin-top: 15px; padding: 10px; background: #d1ecf1; border-radius: 5px;">
                                <strong style="color: #0c5460;">Extra Tables (${response.extra_tables.length}):</strong>
                                <ul style="margin: 5px 0 0 20px; color: #0c5460;">
                                    ${response.extra_tables.map(table => `<li>${table}</li>`).join('')}
                                </ul>
                                <p style="margin-top: 10px; color: #0c5460;">
                                    These tables exist in the database but not in models.
                                </p>
                            </div>
                        `;
                    }
                    
                    html += '</div>';
                    contentDiv.innerHTML = html;
                } else {
                    contentDiv.innerHTML = `<div class="alert alert-error">Error: ${response.message || 'Failed to check schema'}</div>`;
                }
            } catch (error) {
                contentDiv.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
            }
        }
        
        async function syncDatabaseSchema() {
            if (!confirm('Are you sure you want to sync the database schema? This will create any missing tables.')) {
                return;
            }
            
            const contentDiv = document.getElementById('schema-status-content');
            contentDiv.innerHTML = '<div class="loading"></div>Synchronizing schema...';
            
            try {
                const response = await apiRequest('/api/v1/admin/database/schema/sync', {
                    method: 'POST'
                });
                
                if (response.success) {
                    const icon = response.changes_made ? '‚úÖ' : '‚ÑπÔ∏è';
                    let message = `${icon} ${response.message}`;
                    
                    if (response.tables_created && response.tables_created.length > 0) {
                        message += `<br><br><strong>Created Tables:</strong><ul style="margin: 5px 0 0 20px;">
                            ${response.tables_created.map(table => `<li>${table}</li>`).join('')}
                        </ul>`;
                    }
                    
                    contentDiv.innerHTML = `<div class="alert alert-success">${message}</div>`;
                    showAlert(response.message, 'success');
                    
                    // Reload status after sync
                    setTimeout(() => checkSchemaStatus(), 2000);
                } else {
                    contentDiv.innerHTML = `<div class="alert alert-error">Error: ${response.message || 'Schema sync failed'}</div>`;
                    showAlert(response.message || 'Schema sync failed', 'error');
                }
            } catch (error) {
                contentDiv.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
                showAlert(`Schema sync failed: ${error.message}`, 'error');
            }
        }
        
        async function createDatabaseBackup() {
            const statusDiv = document.getElementById('backup-status');
            statusDiv.innerHTML = '<div class="loading"></div>Creating backup...';
            
            try {
                const response = await apiRequest('/api/v1/admin/database/backup', {
                    method: 'POST'
                });
                
                if (response.success) {
                    const backup = response.backup;
                    statusDiv.innerHTML = `
                        <div class="alert alert-success">
                            ‚úÖ Backup created successfully!
                            <div style="margin-top: 10px; padding: 10px; background: #fff; border-radius: 5px;">
                                <div><strong>Filename:</strong> ${backup.filename}</div>
                                <div><strong>Size:</strong> ${backup.size_mb} MB</div>
                                <div><strong>Type:</strong> ${backup.type}</div>
                                <div style="margin-top: 10px;">
                                    <a href="/api/v1/admin/database/backups/${backup.filename}" 
                                       download="${backup.filename}" 
                                       class="btn" 
                                       style="display: inline-block; text-decoration: none;">
                                        üì• Download Backup
                                    </a>
                                </div>
                            </div>
                        </div>
                    `;
                    showAlert('Backup created successfully!', 'success');
                    
                    // Reload backups list
                    setTimeout(() => loadBackupsList(), 1000);
                } else {
                    statusDiv.innerHTML = `<div class="alert alert-error">Error: ${response.message || 'Backup creation failed'}</div>`;
                    showAlert(response.message || 'Backup creation failed', 'error');
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
                showAlert(`Backup failed: ${error.message}`, 'error');
            }
        }
        
        async function loadBackupsList() {
            const listDiv = document.getElementById('backups-list');
            
            try {
                const response = await apiRequest('/api/v1/admin/database/backups');
                
                if (response.success && response.backups && response.backups.length > 0) {
                    listDiv.innerHTML = `
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                        <th style="padding: 10px; text-align: left;">Filename</th>
                                        <th style="padding: 10px; text-align: left;">Size</th>
                                        <th style="padding: 10px; text-align: left;">Created</th>
                                        <th style="padding: 10px; text-align: left;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${response.backups.map(backup => `
                                        <tr style="border-bottom: 1px solid #dee2e6;">
                                            <td style="padding: 10px;">${backup.filename}</td>
                                            <td style="padding: 10px;">${backup.size_mb} MB</td>
                                            <td style="padding: 10px;">${new Date(backup.created).toLocaleString()}</td>
                                            <td style="padding: 10px;">
                                                <a href="/api/v1/admin/database/backups/${backup.filename}" 
                                                   download="${backup.filename}" 
                                                   class="btn btn-sm" 
                                                   style="display: inline-block; padding: 5px 10px; font-size: 0.9rem; text-decoration: none;">
                                                    üì• Download
                                                </a>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">
                            Total: ${response.count} backup(s) | Directory: ${response.backup_directory}
                        </p>
                    `;
                } else {
                    listDiv.innerHTML = '<p style="color: #666;">No backups found. Create your first backup above.</p>';
                }
            } catch (error) {
                listDiv.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
            }
        }
        
        // Load database tab data when the tab is activated
        document.addEventListener('DOMContentLoaded', () => {
            // Existing tab initialization code...
            
            // Add event listener for database tab
            const originalShowTab = window.showTab;
            window.showTab = function(tabName) {
                if (originalShowTab) {
                    originalShowTab(tabName);
                }
                
                // Load database info when database tab is shown
                if (tabName === 'database') {
                    loadDatabaseInfo();
                    checkSchemaStatus();
                    loadBackupsList();
                }
            };
        });
    </script>
    
    <!-- Edit Persona Modal -->
    <div id="editPersonaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">‚úèÔ∏è Edit Persona</div>
                <button class="modal-close" onclick="closeEditPersonaModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editPersonaForm">
                    <!-- Basic Information -->
                    <div class="form-section">
                        <div class="form-section-title">üìã Basic Information</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Persona Name *</label>
                                <input type="text" class="form-control" id="edit-name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="edit-is-active">
                                    <label for="edit-is-active">Active</label>
                                </div>
                                <div class="help-text">Active personas can generate content</div>
                            </div>
                        </div>
                        <div class="form-row full-width">
                            <div class="form-group">
                                <label class="form-label">Appearance Description *</label>
                                <textarea class="form-control" id="edit-appearance" required></textarea>
                                <div class="help-text">Physical appearance for image generation (min 10 characters)</div>
                            </div>
                        </div>
                        <div class="form-row full-width">
                            <div class="form-group">
                                <label class="form-label">Personality Description *</label>
                                <textarea class="form-control" id="edit-personality" required></textarea>
                                <div class="help-text">Personality traits and characteristics (min 10 characters)</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content Themes -->
                    <div class="form-section">
                        <div class="form-section-title">üéØ Content Themes</div>
                        <div class="form-group">
                            <label class="form-label">Add Theme</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" class="form-control" id="edit-theme-input" placeholder="e.g., technology, fitness, fashion">
                                <button type="button" class="btn btn-secondary" onclick="addTheme()">Add</button>
                            </div>
                            <div class="help-text">Maximum 10 themes. Press Enter or click Add.</div>
                        </div>
                        <div class="chip-container" id="edit-themes-container"></div>
                    </div>
                    
                    <!-- Style Preferences -->
                    <div class="form-section">
                        <div class="form-section-title">üé® Style Preferences</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Tone</label>
                                <select class="form-control" id="edit-style-tone">
                                    <option value="friendly">Friendly</option>
                                    <option value="professional">Professional</option>
                                    <option value="casual">Casual</option>
                                    <option value="formal">Formal</option>
                                    <option value="humorous">Humorous</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Format</label>
                                <select class="form-control" id="edit-style-format">
                                    <option value="casual">Casual</option>
                                    <option value="structured">Structured</option>
                                    <option value="storytelling">Storytelling</option>
                                    <option value="educational">Educational</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content Rating & Filtering -->
                    <div class="form-section">
                        <div class="form-section-title">üîû Content Rating & Filtering</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Default Content Rating</label>
                                <select class="form-control" id="edit-default-rating">
                                    <option value="sfw">SFW (Safe for Work)</option>
                                    <option value="moderate">Moderate</option>
                                    <option value="nsfw">NSFW (Not Safe for Work)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Allowed Ratings</label>
                                <div style="margin-top: 10px;">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="edit-rating-sfw" value="sfw">
                                        <label for="edit-rating-sfw">SFW</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="edit-rating-moderate" value="moderate">
                                        <label for="edit-rating-moderate">Moderate</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="edit-rating-nsfw" value="nsfw">
                                        <label for="edit-rating-nsfw">NSFW</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Platform Restrictions -->
                    <div class="form-section">
                        <div class="form-section-title">üåê Per-Platform Content Restrictions</div>
                        <div class="form-group">
                            <label class="form-label">Platform-Specific Rules</label>
                            <div class="help-text">Configure different content ratings for different platforms</div>
                            <div id="edit-platform-restrictions-container" style="margin-top: 15px;">
                                <!-- Platform restrictions will be added here dynamically -->
                            </div>
                            <button type="button" class="btn btn-secondary" style="margin-top: 10px;" onclick="addPlatformRestriction()">+ Add Platform Rule</button>
                        </div>
                    </div>
                    
                    <!-- Base Seed Image -->
                    <div class="form-section">
                        <div class="form-section-title">üñºÔ∏è Base Seed Image</div>
                        <div class="form-row full-width">
                            <div class="form-group">
                                <label class="form-label">Baseline Appearance Description</label>
                                <textarea class="form-control" id="edit-base-appearance" style="min-height: 80px;"></textarea>
                                <div class="help-text">Detailed baseline appearance for visual consistency (max 5000 characters)</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Base Image Path</label>
                                <input type="text" class="form-control" id="edit-base-image-path" placeholder="/models/base_images/persona_ref.jpg">
                                <div class="help-text">Path to reference image for consistency</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Image Status</label>
                                <select class="form-control" id="edit-base-image-status">
                                    <option value="pending_upload">Pending Upload</option>
                                    <option value="draft">Draft</option>
                                    <option value="approved">Approved</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="edit-appearance-locked">
                                    <label for="edit-appearance-locked">Lock Appearance</label>
                                </div>
                                <div class="help-text">When locked, prevents appearance changes and enables consistency features</div>
                            </div>
                        </div>
                        <div class="image-preview-container">
                            <img id="edit-image-preview" class="image-preview" alt="Preview">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeEditPersonaModal()">Cancel</button>
                <button type="button" class="btn" onclick="savePersonaEdits()">Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- View Content Modal -->
    <div id="viewContentModal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <div class="modal-title">
                    <span style="font-size: 1.5rem;">üëÅÔ∏è View Content</span>
                    <div style="display: flex; gap: 10px; margin-top: 8px;">
                        <span id="view-content-type" class="content-type" style="font-size: 0.75rem;"></span>
                        <span id="view-content-rating" class="content-rating" style="font-size: 0.75rem;"></span>
                    </div>
                </div>
                <button class="modal-close" onclick="closeViewContentModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-section">
                    <div class="form-section-title">üìã Content Details</div>
                    <div class="form-group">
                        <label class="form-label">Title</label>
                        <div id="view-content-title" style="padding: 8px; background: #f5f5f5; border-radius: 6px; font-weight: 500;"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <div id="view-content-description" style="padding: 8px; background: #f5f5f5; border-radius: 6px;"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Created</label>
                            <div id="view-content-created" style="padding: 8px; background: #f5f5f5; border-radius: 6px;"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <div id="view-content-status" style="padding: 8px; background: #f5f5f5; border-radius: 6px; text-transform: uppercase; font-weight: 500;"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Quality Score</label>
                            <div id="view-content-quality" style="padding: 8px; background: #f5f5f5; border-radius: 6px; font-weight: 500;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <div class="form-section-title">üé® Content Preview</div>
                    <div id="view-content-preview" style="min-height: 200px;"></div>
                </div>
                
                <div class="form-section">
                    <div class="form-section-title">‚öôÔ∏è Generation Parameters</div>
                    <div id="view-content-params"></div>
                </div>
                
                <div class="form-section" style="border-bottom: none;">
                    <div class="form-section-title">üì± Platform Adaptations</div>
                    <div id="view-content-adaptations"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeViewContentModal()">Close</button>
            </div>
        </div>
    </div>
</body>
</html>