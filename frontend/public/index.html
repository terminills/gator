<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gator Influencer Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            padding: 40px 0;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .card p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: opacity 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .feature {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 8px;
            color: white;
            text-align: center;
        }
        
        .feature h4 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .status {
            display: inline-block;
            background: #10B981;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêä Gator Platform</h1>
            <p>Private Influencer Content Creation System</p>
            <div style="margin-top: 20px;">
                <span class="status" id="system-status">‚è≥ Checking Status...</span>
            </div>
            <div id="stats-container" style="margin-top: 20px; display: flex; gap: 30px; justify-content: center; flex-wrap: wrap;">
                <!-- Dynamic stats will be loaded here -->
            </div>
        </div>
        
        <div class="dashboard">
            <div class="card">
                <h3>üé≠ Persona Management</h3>
                <p id="persona-info">Loading persona information...</p>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <a href="/admin" class="btn">Manage Personas</a>
                    <a href="/gallery" class="btn" style="background: #28a745;">View Gallery</a>
                </div>
            </div>
            
            <div class="card">
                <h3>üé® Content Creation</h3>
                <p id="content-info">Loading content creation info...</p>
                <button onclick="generateContent()" class="btn" id="generate-btn">Create Content Now</button>
            </div>
            
            <div class="card">
                <h3>üì° RSS Feed Monitoring</h3>
                <p id="rss-info">Loading RSS feed information...</p>
                <a href="/docs#/rss-feeds" class="btn">Manage Feeds</a>
            </div>
            
            <div class="card">
                <h3>ü§ñ Model Setup</h3>
                <p id="model-info">Loading model information...</p>
                <a href="/ai-models-setup" class="btn">Configure Models</a>
            </div>
            
            <div class="card">
                <h3>üì± Social Media Integration</h3>
                <p id="social-info">Connect and publish to multiple platforms.</p>
                <a href="/docs#/social-media" class="btn">Social Media</a>
            </div>
            
            <div class="card">
                <h3>üìä Creator Dashboard</h3>
                <p id="analytics-info">Loading analytics...</p>
                <a href="/admin" class="btn">Creator Panel</a>
            </div>
        </div>
        
        <div class="features" id="ai-features">
            <!-- Dynamic AI capabilities will be loaded here -->
        </div>
        
        <div style="margin-top: 40px;">
            <h2 style="text-align: center; color: white; margin-bottom: 20px;">üé® Recent Content</h2>
            <div id="recent-content" class="dashboard">
                <!-- Recent generated content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Global state
        let systemData = {
            personas: [],
            content: [],
            models: {},
            analytics: {}
        };

        // Check system health and load all data
        async function checkHealth() {
            try {
                const response = await fetch('/health');
                const health = await response.json();
                
                const statusEl = document.getElementById('system-status');
                if (health.status === 'healthy' && health.database === 'healthy') {
                    statusEl.innerHTML = '‚úÖ System Online';
                    statusEl.style.background = '#10B981';
                } else if (health.status === 'healthy') {
                    statusEl.innerHTML = '‚ö†Ô∏è Database Issues';
                    statusEl.style.background = '#F59E0B';
                } else {
                    statusEl.innerHTML = '‚ö†Ô∏è System Issues';
                    statusEl.style.background = '#F59E0B';
                }
            } catch (error) {
                const statusEl = document.getElementById('system-status');
                statusEl.innerHTML = '‚ùå System Offline';
                statusEl.style.background = '#EF4444';
            }
        }
        
        // Load system statistics
        async function loadStats() {
            try {
                // Load personas
                const personasResp = await fetch('/api/v1/personas/');
                const personasData = await personasResp.json();
                systemData.personas = personasData.personas || [];
                
                // Load content
                const contentResp = await fetch('/api/v1/content/');
                const contentData = await contentResp.json();
                systemData.content = contentData.content || [];
                
                // Load AI model status
                try {
                    const modelsResp = await fetch('/api/v1/setup/ai-models/status');
                    const modelsData = await modelsResp.json();
                    systemData.models = modelsData;
                } catch (e) {
                    console.log('AI models endpoint not available yet');
                }
                
                // Load analytics if available
                try {
                    const analyticsResp = await fetch('/api/v1/analytics/summary');
                    const analyticsData = await analyticsResp.json();
                    systemData.analytics = analyticsData;
                } catch (e) {
                    console.log('Analytics endpoint not available yet');
                }
                
                updateUI();
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }
        
        // Update UI with loaded data
        function updateUI() {
            // Update stats container
            const statsContainer = document.getElementById('stats-container');
            statsContainer.innerHTML = `
                <div style="text-align: center; color: white;">
                    <div style="font-size: 2rem; font-weight: bold;">${systemData.personas.length}</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">Active Personas</div>
                </div>
                <div style="text-align: center; color: white;">
                    <div style="font-size: 2rem; font-weight: bold;">${systemData.content.length}</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">Created Content</div>
                </div>
                <div style="text-align: center; color: white;">
                    <div style="font-size: 2rem; font-weight: bold;">${getModelCount()}</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">Models</div>
                </div>
            `;
            
            // Update persona info
            const personaInfo = document.getElementById('persona-info');
            if (systemData.personas.length > 0) {
                personaInfo.textContent = `You have ${systemData.personas.length} active persona${systemData.personas.length !== 1 ? 's' : ''} ready to create content.`;
            } else {
                personaInfo.textContent = 'No personas created yet. Create your first persona to start creating content.';
            }
            
            // Update content info
            const contentInfo = document.getElementById('content-info');
            contentInfo.textContent = systemData.content.length > 0 
                ? `${systemData.content.length} pieces of content created. Click below to create more!`
                : 'No content created yet. Start creating content now!';
            
            // Update RSS info
            const rssInfo = document.getElementById('rss-info');
            rssInfo.textContent = 'Monitor and analyze RSS feeds to stay current with trending topics.';
            
            // Update model info
            const modelInfo = document.getElementById('model-info');
            const modelCount = getModelCount();
            if (modelCount > 0) {
                const gpuStatus = systemData.models?.system?.gpu_available ? '‚úÖ GPU Available' : '‚ö†Ô∏è CPU Only';
                modelInfo.textContent = `${modelCount} models available. ${gpuStatus}`;
            } else {
                modelInfo.textContent = 'Configure models to enable local content creation.';
            }
            
            // Update analytics info
            const analyticsInfo = document.getElementById('analytics-info');
            analyticsInfo.textContent = 'Monitor performance, analytics, and get optimization suggestions.';
            
            // Update AI features
            updateAIFeatures();
            
            // Update recent content
            updateRecentContent();
        }
        
        // Get model count from system data
        function getModelCount() {
            if (!systemData.models?.installed_models) return 0;
            return systemData.models.installed_models.length;
        }
        
        // Update AI features section
        function updateAIFeatures() {
            const featuresContainer = document.getElementById('ai-features');
            const features = [];
            
            if (systemData.models?.system?.gpu_available) {
                features.push({
                    icon: 'üéÆ',
                    title: 'GPU Acceleration',
                    desc: `${systemData.models.system.gpu_count || 1} GPU(s) available for fast creation`
                });
            }
            
            if (systemData.models?.installed_models?.length > 0) {
                features.push({
                    icon: 'ü§ñ',
                    title: 'Local Models',
                    desc: `${systemData.models.installed_models.length} models installed for offline creation`
                });
            } else {
                features.push({
                    icon: '‚òÅÔ∏è',
                    title: 'Cloud APIs',
                    desc: 'OpenAI, Anthropic, and other cloud models available'
                });
            }
            
            features.push({
                icon: 'üîí',
                title: 'Privacy First',
                desc: 'Self-hosted solution with complete data control'
            });
            
            features.push({
                icon: 'üéØ',
                title: 'Smart Content',
                desc: 'Trend-aware generation based on RSS feed analysis'
            });
            
            featuresContainer.innerHTML = features.map(f => `
                <div class="feature">
                    <h4>${f.icon} ${f.title}</h4>
                    <p>${f.desc}</p>
                </div>
            `).join('');
        }
        
        // Update recent content section
        function updateRecentContent() {
            const recentContainer = document.getElementById('recent-content');
            
            if (systemData.content.length === 0) {
                recentContainer.innerHTML = `
                    <div class="card" style="grid-column: 1 / -1; text-align: center;">
                        <h3>No content created yet</h3>
                        <p style="margin: 20px 0;">Start creating content by clicking "Create Content Now" above!</p>
                    </div>
                `;
                return;
            }
            
            // Show most recent 6 items
            const recentItems = systemData.content.slice(0, 6);
            recentContainer.innerHTML = recentItems.map(item => `
                <div class="card">
                    <h3>${item.content_type || 'Content'}</h3>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">
                        ${item.persona_name || 'Unknown Persona'}
                    </p>
                    ${item.prompt ? `<p style="font-size: 0.85rem; color: #888; margin-bottom: 10px;">${item.prompt.substring(0, 100)}...</p>` : ''}
                    <div style="font-size: 0.8rem; color: #999;">
                        ${new Date(item.created_at).toLocaleDateString()}
                    </div>
                </div>
            `).join('');
        }
        
        // Generate content function
        async function generateContent() {
            const btn = document.getElementById('generate-btn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Creating...';
            
            try {
                const response = await fetch('/api/v1/content/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        content_type: 'image',
                        prompt: 'Create engaging social media content'
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    btn.textContent = '‚úÖ Content Created!';
                    btn.style.background = '#28a745';
                    
                    // Reload data after 2 seconds
                    setTimeout(() => {
                        loadStats();
                        btn.disabled = false;
                        btn.textContent = 'Create Content Now';
                        btn.style.background = '';
                    }, 2000);
                } else {
                    throw new Error(result.detail || 'Creation failed');
                }
            } catch (error) {
                console.error('Failed to create content:', error);
                btn.textContent = '‚ùå Failed - Try Again';
                btn.disabled = false;
                setTimeout(() => {
                    btn.textContent = 'Create Content Now';
                }, 3000);
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            checkHealth();
            loadStats();
            
            // Refresh every 30 seconds
            setInterval(() => {
                checkHealth();
                loadStats();
            }, 30000);
        });
    </script>
</body>
</html>